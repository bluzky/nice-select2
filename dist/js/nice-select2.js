!function(c,l){"object"==typeof exports&&"object"==typeof module?module.exports=l():"function"==typeof define&&define.amd?define([],l):"object"==typeof exports?exports.NiceSelect=l():c.NiceSelect=l()}(self,()=>(()=>{"use strict";var __webpack_modules__={462:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   bind: () => (/* binding */ bind),\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n\r\n\r\nconst triggerEvent      = (el, type, init = {}) => {\r\n  let EventConstructor;\r\n  if (type === "click") {\r\n    EventConstructor = MouseEvent;\r\n  } else if (type === "change") {\r\n    EventConstructor = Event;\r\n  } else if (type.includes("focus")) {\r\n    EventConstructor = FocusEvent;\r\n  } else {\r\n    EventConstructor = UIEvent;\r\n  }\r\n  const event = new EventConstructor(type, {\r\n    bubbles: true,\r\n    cancelable: false,\r\n    ...init,\r\n  });\r\n  el.dispatchEvent(event);\r\n};\r\n\r\nconst triggerClick      = (el) => triggerEvent(el, "click");\r\nconst triggerChange     = (el) => triggerEvent(el, "change");\r\nconst triggerFocusIn    = (el) => triggerEvent(el, "focusin");\r\nconst triggerFocusOut   = (el) => triggerEvent(el, "focusout");\r\nconst triggerModalOpen  = (el) => triggerEvent(el, "modalopen");\r\nconst triggerModalClose = (el) => triggerEvent(el, "modalclose");\r\n\r\nconst attr              = (el, key) => el[key] !== undefined ? el[key] : el.getAttribute(key);\r\nconst data              = (el, key) => el.getAttribute("data-" + key);\r\nconst hasClass          = (el, className) => el?.classList.contains(className);\r\nconst addClass          = (el, className) => el?.classList.add(className);\r\nconst removeClass       = (el, className) => el?.classList.remove(className);\r\n\r\nconst defaultOptions = {\r\n  data: null,\r\n  searchable: true,\r\n  showSelectedItems: true,\r\n  placeholder: "Select an option",\r\n  searchtext: "Search",\r\n  selectedtext: "selected",\r\n};\r\n\r\nclass NiceSelect {\r\n  constructor(element, options = {}) {\r\n    if (!element) {\r\n      throw new Error(\'No element provided to NiceSelect\');\r\n    }\r\n\r\n    if (!(element instanceof Element)) {\r\n      throw new Error(\'Invalid element provided to NiceSelect - must be a valid DOM element\');\r\n    }\r\n\r\n    this.el               = element;\r\n    this.config           = { ...defaultOptions, ...options };\r\n    this.data             = this.config.data;\r\n    this.selectedOptions  = [];\r\n    this.placeholder      = attr(this.el, "placeholder") || this.config.placeholder;\r\n    this.searchtext       = attr(this.el, "searchtext") || this.config.searchtext;\r\n    this.selectedtext     = attr(this.el, "selectedtext") || this.config.selectedtext;\r\n    this.dropdown         = null;\r\n    this.selectionList    = null;\r\n    this.multiple         = attr(this.el, "multiple");\r\n    this.disabled         = attr(this.el, "disabled");\r\n    this.create();\r\n  }\r\n\r\n  create() {\r\n    Object.assign(this.el.style, {\r\n      opacity: "0",\r\n      width: "0",\r\n      padding: "0",\r\n      height: "0",\r\n      fontSize: "0",\r\n      minHeight: "auto",\r\n    });\r\n\r\n    this.data ? this.processData(this.data) : this.extractData();\r\n    this.renderDropdown();\r\n    this.bindEvent();\r\n  }\r\n\r\n  processData(data) {\r\n    this.options = data.map((item) => ({\r\n      data: item,\r\n      attributes: {\r\n        selected: !!item.selected,\r\n        disabled: !!item.disabled,\r\n        optgroup: item.value === "optgroup",\r\n      },\r\n    }));\r\n  }\r\n\r\n  extractData() {\r\n    const options = Array.from(this.el.querySelectorAll("option,optgroup"));\r\n    const allOptions = [];\r\n    const selectedOptions = [];\r\n\r\n    this.data = options.map((item) => {\r\n      let itemData;\r\n\r\n      if (item.tagName === "OPTGROUP") {\r\n        itemData = { text: item.label, value: "optgroup" };\r\n      } else {\r\n        const text = item.dataset.display ?? item.innerText;\r\n        itemData = {\r\n          text,\r\n          value: item.value,\r\n          extra: item.dataset.extra,\r\n          selected: item.hasAttribute("selected"),\r\n          disabled: item.hasAttribute("disabled"),\r\n        };\r\n      }\r\n\r\n      const attributes = {\r\n        selected: item.hasAttribute("selected"),\r\n        disabled: item.hasAttribute("disabled"),\r\n        optgroup: item.tagName === "OPTGROUP",\r\n      };\r\n\r\n      const optionObj = { data: itemData, attributes, element: null };\r\n\r\n      allOptions.push(optionObj);\r\n\r\n      if (attributes.selected) selectedOptions.push(optionObj);\r\n\r\n      return itemData;\r\n    });\r\n\r\n    this.options          = allOptions;\r\n    this.selectedOptions  = selectedOptions;\r\n  }\r\n\r\n  renderDropdown() {\r\n    const classes = [\r\n      "nice-select",\r\n      attr(this.el, "class") || "",\r\n      this.disabled ? "disabled" : "",\r\n      this.multiple ? "has-multiple" : "",\r\n    ].filter(Boolean);\r\n\r\n    const searchHtml = this.config.searchable\r\n      ? `\r\n      <div class="nice-select-search-box">\r\n        <input type="text" class="nice-select-search" placeholder="${this.searchtext}..." title="search"/>\r\n      </div>\r\n    `\r\n      : "";\r\n\r\n    const html = `\r\n      <div class="${classes.join(" ")}" tabindex="${this.disabled ? "" : 0}">\r\n        <span class="${this.multiple ? "multiple-options" : "current"}"></span>\r\n        <div class="nice-select-dropdown">\r\n          ${searchHtml}\r\n          <ul class="list"></ul>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.el.insertAdjacentHTML("afterend", html);\r\n\r\n    this.dropdown = this.el.nextElementSibling;\r\n\r\n    this._renderSelectedItems();\r\n\r\n    this._renderItems();\r\n  }\r\n\r\n  _renderSelectedItems() {\r\n    if (this.multiple) {\r\n      let selectedHtml = "";\r\n\r\n      if (\r\n        window.getComputedStyle(this.dropdown).width === "auto" ||\r\n        this.selectedOptions.length < 2\r\n      ) {\r\n        this.selectedOptions.forEach( (item, index, array) => {\r\n          let text  = item.data.text;\r\n\r\n          if(index !== array.length -1 ){\r\n            text += `, `;\r\n          }\r\n\r\n          selectedHtml += `<span class="current">${text}</span>`;\r\n        });\r\n\r\n        selectedHtml = selectedHtml || this.placeholder;\r\n      } else {\r\n        selectedHtml = `${this.selectedOptions.length} ${this.selectedtext}`;\r\n      }\r\n\r\n      this.dropdown.querySelector(".multiple-options").innerHTML = selectedHtml;\r\n    } else {\r\n      const html =\r\n        this.selectedOptions.length > 0\r\n          ? this.selectedOptions[0].data.text\r\n          : this.placeholder;\r\n\r\n      this.dropdown.querySelector(".current").innerHTML = html;\r\n    }\r\n  }\r\n\r\n  _renderItems() {\r\n    const ul = this.dropdown.querySelector("ul");\r\n\r\n    this.options.forEach((item) => {\r\n\r\n      if(this.multiple && this.config.showSelectedItems){\r\n        this._multipleListAdd(item);\r\n      }\r\n\r\n      ul.appendChild(this._renderItem(item));\r\n    });\r\n  }\r\n\r\n  _renderItem(option) {\r\n    const li      = document.createElement("li");\r\n    li.innerHTML  = option.data.text;\r\n\r\n    if (option.data.extra !== undefined) {\r\n      li.appendChild(this._renderItemExtra(option.data.extra));\r\n    }\r\n\r\n    if (option.attributes.optgroup) {\r\n      addClass(li, "optgroup");\r\n    } else {\r\n      li.setAttribute("data-value", option.data.value);\r\n      const classList = ["option"];\r\n      if (option.attributes.selected) classList.push("selected");\r\n      if (option.attributes.disabled) classList.push("disabled");\r\n      li.classList.add(...classList);\r\n      li.addEventListener("click", (e) => this._onItemClicked(option, e));\r\n    }\r\n\r\n    option.element = li;\r\n\r\n    return li;\r\n  }\r\n\r\n  _renderItemExtra(content) {\r\n    const span      = document.createElement("span");\r\n    span.innerHTML  = content;\r\n    addClass(span, "extra");\r\n\r\n    return span;\r\n  }\r\n\r\n  update() {\r\n    this.extractData();\r\n\r\n    if (this.dropdown) {\r\n      const open = hasClass(this.dropdown, "open");\r\n      this.dropdown.remove();\r\n      this.create();\r\n      if (open) {\r\n        triggerClick(this.dropdown);\r\n      }\r\n    }\r\n\r\n    attr(this.el, "disabled") ? this.disable() : this.enable();\r\n  }\r\n\r\n  disable() {\r\n    if (!this.disabled) {\r\n      this.disabled = true;\r\n      addClass(this.dropdown, "disabled");\r\n    }\r\n  }\r\n\r\n  enable() {\r\n    if (this.disabled) {\r\n      this.disabled = false;\r\n      removeClass(this.dropdown, "disabled");\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.resetSelectValue();\r\n    this.selectedOptions = [];\r\n    this._renderSelectedItems();\r\n    this.update();\r\n    triggerChange(this.el);\r\n  }\r\n\r\n  destroy() {\r\n    if(this.selectionList){\r\n      this.selectionList.remove();\r\n    }\r\n\r\n    if (this.dropdown) {\r\n      this.dropdown.remove();\r\n      this.el.style.display   = "";\r\n      this.el.style.opacity   = \'\';\r\n      this.el.style.width     = \'\';\r\n      this.el.style.padding   = \'\';\r\n      this.el.style.height    = \'\';\r\n      this.el.style.fontSize  = \'\';\r\n      this.el.style.minHeight = \'\';\r\n    }\r\n  }\r\n\r\n  focus(target=\'\'){\r\n    const isOpen = hasClass(this.dropdown, "open");\r\n\r\n    if (!isOpen) {\r\n      addClass(this.dropdown, "open");\r\n      triggerModalOpen(this.el);\r\n    } else {\r\n      if (this.multiple) {\r\n        if (target === this.dropdown.querySelector(".multiple-options")) {\r\n          removeClass(this.dropdown, "open");\r\n          triggerModalClose(this.el);\r\n        }\r\n      } else {\r\n        removeClass(this.dropdown, "open");\r\n        triggerModalClose(this.el);\r\n      }\r\n    }\r\n\r\n    if (hasClass(this.dropdown, "open")) {\r\n      const search = this.dropdown.querySelector(".nice-select-search");\r\n\r\n      if (search) {\r\n        search.value = "";\r\n        search.focus();\r\n      }\r\n\r\n      const focused = this.dropdown.querySelector(".focus");\r\n\r\n      if (focused) removeClass(focused, "focus");\r\n\r\n      const selected = this.dropdown.querySelector(".selected");\r\n      if (selected) addClass(selected, "focus");\r\n\r\n      this.dropdown\r\n        .querySelectorAll("ul li")\r\n        .forEach((item) => (item.style.display = ""));\r\n    } else {\r\n      this.dropdown.focus();\r\n    }\r\n  }\r\n\r\n  updateSelect(){\r\n    console.log(\'test\');\r\n    this.update();\r\n  }\r\n\r\n  bindEvent() {\r\n    this.dropdown.addEventListener("click", (e) => this._onClicked(e));\r\n    this.dropdown.addEventListener("keydown", (e) => this._onKeyPressed(e));\r\n    this.dropdown.addEventListener("focusin", () => triggerFocusIn(this.el));\r\n    this.dropdown.addEventListener("focusout", () => triggerFocusOut(this.el));\r\n    this.el.addEventListener("invalid", () => this._triggerValidationMessage("invalid"));\r\n    this.el.addEventListener("change", () => this.updateSelect());\r\n    window.addEventListener("click", (e) => this._onClickedOutside(e));\r\n\r\n    if (this.config.searchable) this._bindSearchEvent();\r\n  }\r\n\r\n  _bindSearchEvent() {\r\n    const searchBox = this.dropdown.querySelector(".nice-select-search");\r\n    if (searchBox) {\r\n      searchBox.addEventListener("click", (e) => e.stopPropagation());\r\n      searchBox.addEventListener("input", (e) => this._onSearchChanged(e));\r\n    }\r\n  }\r\n\r\n  _onClicked(e) {\r\n    e.preventDefault();\r\n\r\n    this.focus(e.target);\r\n  }\r\n\r\n  _onItemClicked(option, e) {\r\n    const optionEl = e.target;\r\n    if (!hasClass(optionEl, "disabled")) {\r\n      if (this.multiple) {\r\n        if (hasClass(optionEl, "selected")) {\r\n          removeClass(optionEl, "selected");\r\n          this.selectedOptions = this.selectedOptions.filter(\r\n            (item) => item !== option\r\n          );\r\n          const opt = this.el.querySelector(\r\n            `option[value="${optionEl.dataset.value}"]`\r\n          );\r\n          if (opt) {\r\n            opt.removeAttribute("selected");\r\n            opt.selected = false;\r\n          }\r\n\r\n          this._multipleListRemove(option);\r\n        } else {\r\n          addClass(optionEl, "selected");\r\n          this.selectedOptions.push(option);\r\n\r\n          if(this.config.showSelectedItems){\r\n            option.attributes.selected = true;\r\n            this._multipleListAdd(option);\r\n          }\r\n        }\r\n      } else {\r\n        this.options.forEach((item) => removeClass(item.element, "selected"));\r\n\r\n        addClass(optionEl, "selected");\r\n\r\n        this.selectedOptions = [option];\r\n      }\r\n\r\n      this._renderSelectedItems();\r\n\r\n      this.updateSelectValue();\r\n    }\r\n  }\r\n\r\n  setValue(value) {\r\n    const select = this.el;\r\n    let noSelected = true;\r\n\r\n    // Validate input type\r\n    if (select.multiple) {\r\n      if (!Array.isArray(value)) {\r\n        throw new Error(\'setValue expects an array for multiple select elements\');\r\n      }\r\n\r\n      value = value.map(String);\r\n    } else {\r\n      if (Array.isArray(value)) {\r\n        throw new Error(\'setValue expects a single value for non-multiple select elements\');\r\n      }\r\n\r\n      if (value !== null && value !== undefined && typeof value !== \'string\' && typeof value !== \'number\') {\r\n        throw new Error(\'setValue expects a string or number for non-multiple select elements\');\r\n      }\r\n\r\n      value = String(value);\r\n    }\r\n\r\n    for (const opt of select.options) {\r\n      const currentValue = select.multiple\r\n        ? value.includes(opt.value)\r\n          ? opt.value\r\n          : null\r\n        : value;\r\n      if (opt.value === currentValue && !opt.disabled) {\r\n        if (noSelected) {\r\n          select.value = currentValue;\r\n          noSelected = false;\r\n        }\r\n\r\n        opt.setAttribute("selected", true);\r\n        opt.selected = true;\r\n      } else {\r\n        opt.removeAttribute("selected");\r\n        opt.selected = false;\r\n      }\r\n    }\r\n\r\n    if (noSelected && !select.multiple && select.options.length) {\r\n      select.options[0].setAttribute("selected", true);\r\n      select.options[0].selected = true;\r\n      select.value = select.options[0].value;\r\n    }\r\n\r\n    this.update();\r\n  }\r\n\r\n  getValue() {\r\n    const select = this.el;\r\n    if (!select.multiple) return select.value;\r\n\r\n    return Array.from(select.options)\r\n      .filter((opt) => opt.selected)\r\n      .map((opt) => opt.value);\r\n  }\r\n\r\n  updateSelectValue() {\r\n    if (this.selectedOptions.length > 0) {\r\n      this.el.value = this.selectedOptions[0].data.value;\r\n    }\r\n\r\n    const select = this.el;\r\n\r\n    // FIrst mark all options as not selected\r\n    select.querySelectorAll("option").forEach(function (item) {\r\n      item.removeAttribute("selected");\r\n    });\r\n\r\n    // Mark the selected options as selected in the select element\r\n    this.selectedOptions.forEach( item => {\r\n      let el = select.querySelector(`option[value="${item.data.value}"]`);\r\n\r\n      if (el){\r\n        //Change it, cause it works more correctly.\r\n        el.setAttribute("selected", "selected");\r\n        el.selected = true;\r\n      }\r\n    });\r\n\r\n    triggerChange(this.el);\r\n  }\r\n\r\n  resetSelectValue() {\r\n    if (this.multiple) {\r\n      const select = this.el;\r\n      this.selectedOptions.forEach((item) => {\r\n        const el = select.querySelector(`option[value="${item.data.value}"]`);\r\n        if (el) {\r\n          el.removeAttribute("selected");\r\n          el.selected = false;\r\n        }\r\n      });\r\n    } else if (this.selectedOptions.length > 0) {\r\n      this.el.selectedIndex = -1;\r\n    }\r\n\r\n    triggerChange(this.el);\r\n  }\r\n\r\n  _onClickedOutside(e) {\r\n    if (!this.dropdown.contains(e.target)) {\r\n      removeClass(this.dropdown, "open");\r\n      triggerModalClose(this.el);\r\n    }\r\n  }\r\n\r\n  _onKeyPressed(e) {\r\n    const focusedOption = this.dropdown.querySelector(".focus");\r\n    const isOpen        = hasClass(this.dropdown, "open");\r\n\r\n    if (e.keyCode === 13) {\r\n      isOpen ? triggerClick(focusedOption) : triggerClick(this.dropdown);\r\n    } else if (e.keyCode === 40) {\r\n      if (!isOpen) {\r\n        triggerClick(this.dropdown);\r\n      } else {\r\n        const next = this._findNext(focusedOption);\r\n        if (next) {\r\n          if (focusedOption) removeClass(focusedOption, "focus");\r\n          addClass(next, "focus");\r\n        }\r\n      }\r\n      e.preventDefault();\r\n    } else if (e.keyCode === 38) {\r\n      if (!isOpen) {\r\n        triggerClick(this.dropdown);\r\n      } else {\r\n        const prev = this._findPrev(focusedOption);\r\n        if (prev) {\r\n          if (focusedOption) removeClass(focusedOption, "focus");\r\n          addClass(prev, "focus");\r\n        }\r\n      }\r\n      e.preventDefault();\r\n    } else if (e.keyCode === 27 && isOpen) {\r\n      triggerClick(this.dropdown);\r\n    } else if (e.keyCode === 32 && isOpen) {\r\n      return false;\r\n    }\r\n\r\n    const focus = this.dropdown.querySelector(\'.focus\');\r\n    if (focus) {\r\n      focus.scrollIntoView({ block: \'center\' });\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  _findNext(el) {\r\n    let nextEl = el\r\n      ? el.nextElementSibling\r\n      : this.dropdown.querySelector(".list .option");\r\n    while (nextEl) {\r\n      if (!hasClass(nextEl, "disabled") && nextEl.style.display !== "none")\r\n        return nextEl;\r\n      nextEl = nextEl.nextElementSibling;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _findPrev(el) {\r\n    let prevEl = el\r\n      ? el.previousElementSibling\r\n      : this.dropdown.querySelector(".list .option:last-child");\r\n    while (prevEl) {\r\n      if (!hasClass(prevEl, "disabled") && prevEl.style.display !== "none")\r\n        return prevEl;\r\n      prevEl = prevEl.previousElementSibling;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _onSearchChanged(e) {\r\n    const text = e.target.value.toLowerCase();\r\n\r\n    if (text === "") {\r\n      this.options.forEach((item) => (item.element.style.display = ""));\r\n    } else if (hasClass(this.dropdown, "open")) {\r\n      const matchReg = new RegExp(text);\r\n      this.options.forEach((item) => {\r\n        item.element.style.display = matchReg.test(item.data.text.toLowerCase())\r\n          ? ""\r\n          : "none";\r\n      });\r\n    }\r\n\r\n    this.dropdown\r\n      .querySelectorAll(".focus")\r\n      .forEach((item) => removeClass(item, "focus"));\r\n\r\n    const firstEl = this._findNext(null);\r\n\r\n    if (firstEl) addClass(firstEl, "focus");\r\n  }\r\n\r\n  _triggerValidationMessage(type) {\r\n    if (type === "invalid") {\r\n      addClass(this.dropdown, "invalid");\r\n      removeClass(this.dropdown, "valid");\r\n    } else {\r\n      addClass(this.dropdown, "valid");\r\n      removeClass(this.dropdown, "invalid");\r\n    }\r\n  }\r\n\r\n  _multipleListAdd(option) {\r\n  \r\n    if(option.data.disabled || option.data.value == "" || !option.attributes.selected){\r\n      return;\r\n    }\r\n\r\n    if(this.selectionList == null){\r\n      this.selectionList\t \t\t= document.createElement(\'ul\');\r\n      this.selectionList.classList.add(\'select-selection-list\');\r\n\r\n      this.el.after(this.selectionList);\r\n    }else if(this.selectionList.querySelector(`[data-value="${option.data.value}"]`) != null){\r\n      return;\r\n    }\r\n\r\n    let li\t \t\t= document.createElement(\'li\');\r\n    li.classList.add(\'select-selection\');\r\n\r\n    li.dataset.value = option.data.value;\r\n\r\n    let html\t  = `\r\n      <button type="button" class="small remove-select-selection">\r\n        <span class=\'remove-select-selection\'>×</span>\r\n      </button>\r\n    `;\r\n\r\n    // Add\r\n    html   += `<span class=\'selected-name\'>${option.data.text}</span>`\r\n\r\n    li.innerHTML\t= html;\r\n\r\n    this.selectionList.appendChild(li);\r\n\r\n    li.querySelectorAll(\'.remove-select-selection\').forEach(el=> el.addEventListener("click", this._multipleListRemove.bind(this)));\r\n  }\r\n\r\n  _multipleListRemove(target) {\r\n\r\n    if(target.target != null){\r\n      target  = target.target;\r\n    }\r\n\r\n    if(target.data == undefined){\r\n      target.closest(\'li.select-selection\').remove();\r\n\r\n      let parent  = target.closest(\'li.select-selection\');\r\n\r\n      this.selectedOptions.forEach(option => {\r\n        if(option.data.value == parent.dataset.value){\r\n          removeClass(option.element, "selected");\r\n          this.selectedOptions.splice(this.selectedOptions.indexOf(option), 1);\r\n          var opt = this.el.querySelector(`option[value="${option.data.value}"]`);\r\n          opt.removeAttribute(\'selected\');\r\n          opt.selected = false;\r\n        }\r\n\r\n        this._renderSelectedItems();\r\n      })\r\n\r\n      return;\r\n    }\r\n\r\n    if(target.element.classList.contains(\'selected\')){\r\n      console.log(target);\r\n      return;\r\n    }\r\n\r\n    let parent  = this.el.parentElement;\r\n    \r\n    let ul      = parent.querySelector(\'.select-selection-list\');\r\n    \r\n    target  = ul.querySelector(`[data-value="${target.data.value}"]`);\r\n\r\n    if(ul != null && target != null){\r\n      target.remove();\r\n    }\r\n\r\n  }\r\n}\r\n\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (NiceSelect);\r\nfunction bind(el, options) {\r\n  return new NiceSelect(el, options);\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsdUJBQXVCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsZ0JBQWdCO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELGdCQUFnQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsaUJBQWlCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUsseURBQXlELGtCQUFrQjtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsaUJBQWlCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsa0JBQWtCO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msa0JBQWtCO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBZSxVQUFVLEVBQUM7QUFDbkI7QUFDUDtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vTmljZVNlbGVjdC8uL3NyYy9qcy9uaWNlLXNlbGVjdDIuanM/YjRjOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCIuLi9zY3NzL25pY2Utc2VsZWN0Mi5zY3NzXCI7XHJcblxyXG5jb25zdCB0cmlnZ2VyRXZlbnQgICAgICA9IChlbCwgdHlwZSwgaW5pdCA9IHt9KSA9PiB7XHJcbiAgbGV0IEV2ZW50Q29uc3RydWN0b3I7XHJcbiAgaWYgKHR5cGUgPT09IFwiY2xpY2tcIikge1xyXG4gICAgRXZlbnRDb25zdHJ1Y3RvciA9IE1vdXNlRXZlbnQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcImNoYW5nZVwiKSB7XHJcbiAgICBFdmVudENvbnN0cnVjdG9yID0gRXZlbnQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlLmluY2x1ZGVzKFwiZm9jdXNcIikpIHtcclxuICAgIEV2ZW50Q29uc3RydWN0b3IgPSBGb2N1c0V2ZW50O1xyXG4gIH0gZWxzZSB7XHJcbiAgICBFdmVudENvbnN0cnVjdG9yID0gVUlFdmVudDtcclxuICB9XHJcbiAgY29uc3QgZXZlbnQgPSBuZXcgRXZlbnRDb25zdHJ1Y3Rvcih0eXBlLCB7XHJcbiAgICBidWJibGVzOiB0cnVlLFxyXG4gICAgY2FuY2VsYWJsZTogZmFsc2UsXHJcbiAgICAuLi5pbml0LFxyXG4gIH0pO1xyXG4gIGVsLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG59O1xyXG5cclxuY29uc3QgdHJpZ2dlckNsaWNrICAgICAgPSAoZWwpID0+IHRyaWdnZXJFdmVudChlbCwgXCJjbGlja1wiKTtcclxuY29uc3QgdHJpZ2dlckNoYW5nZSAgICAgPSAoZWwpID0+IHRyaWdnZXJFdmVudChlbCwgXCJjaGFuZ2VcIik7XHJcbmNvbnN0IHRyaWdnZXJGb2N1c0luICAgID0gKGVsKSA9PiB0cmlnZ2VyRXZlbnQoZWwsIFwiZm9jdXNpblwiKTtcclxuY29uc3QgdHJpZ2dlckZvY3VzT3V0ICAgPSAoZWwpID0+IHRyaWdnZXJFdmVudChlbCwgXCJmb2N1c291dFwiKTtcclxuY29uc3QgdHJpZ2dlck1vZGFsT3BlbiAgPSAoZWwpID0+IHRyaWdnZXJFdmVudChlbCwgXCJtb2RhbG9wZW5cIik7XHJcbmNvbnN0IHRyaWdnZXJNb2RhbENsb3NlID0gKGVsKSA9PiB0cmlnZ2VyRXZlbnQoZWwsIFwibW9kYWxjbG9zZVwiKTtcclxuXHJcbmNvbnN0IGF0dHIgICAgICAgICAgICAgID0gKGVsLCBrZXkpID0+IGVsW2tleV0gIT09IHVuZGVmaW5lZCA/IGVsW2tleV0gOiBlbC5nZXRBdHRyaWJ1dGUoa2V5KTtcclxuY29uc3QgZGF0YSAgICAgICAgICAgICAgPSAoZWwsIGtleSkgPT4gZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1cIiArIGtleSk7XHJcbmNvbnN0IGhhc0NsYXNzICAgICAgICAgID0gKGVsLCBjbGFzc05hbWUpID0+IGVsPy5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtcclxuY29uc3QgYWRkQ2xhc3MgICAgICAgICAgPSAoZWwsIGNsYXNzTmFtZSkgPT4gZWw/LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcclxuY29uc3QgcmVtb3ZlQ2xhc3MgICAgICAgPSAoZWwsIGNsYXNzTmFtZSkgPT4gZWw/LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuXHJcbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xyXG4gIGRhdGE6IG51bGwsXHJcbiAgc2VhcmNoYWJsZTogdHJ1ZSxcclxuICBzaG93U2VsZWN0ZWRJdGVtczogdHJ1ZSxcclxuICBwbGFjZWhvbGRlcjogXCJTZWxlY3QgYW4gb3B0aW9uXCIsXHJcbiAgc2VhcmNodGV4dDogXCJTZWFyY2hcIixcclxuICBzZWxlY3RlZHRleHQ6IFwic2VsZWN0ZWRcIixcclxufTtcclxuXHJcbmNsYXNzIE5pY2VTZWxlY3Qge1xyXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgaWYgKCFlbGVtZW50KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZWxlbWVudCBwcm92aWRlZCB0byBOaWNlU2VsZWN0Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCEoZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbGVtZW50IHByb3ZpZGVkIHRvIE5pY2VTZWxlY3QgLSBtdXN0IGJlIGEgdmFsaWQgRE9NIGVsZW1lbnQnKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmVsICAgICAgICAgICAgICAgPSBlbGVtZW50O1xyXG4gICAgdGhpcy5jb25maWcgICAgICAgICAgID0geyAuLi5kZWZhdWx0T3B0aW9ucywgLi4ub3B0aW9ucyB9O1xyXG4gICAgdGhpcy5kYXRhICAgICAgICAgICAgID0gdGhpcy5jb25maWcuZGF0YTtcclxuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zICA9IFtdO1xyXG4gICAgdGhpcy5wbGFjZWhvbGRlciAgICAgID0gYXR0cih0aGlzLmVsLCBcInBsYWNlaG9sZGVyXCIpIHx8IHRoaXMuY29uZmlnLnBsYWNlaG9sZGVyO1xyXG4gICAgdGhpcy5zZWFyY2h0ZXh0ICAgICAgID0gYXR0cih0aGlzLmVsLCBcInNlYXJjaHRleHRcIikgfHwgdGhpcy5jb25maWcuc2VhcmNodGV4dDtcclxuICAgIHRoaXMuc2VsZWN0ZWR0ZXh0ICAgICA9IGF0dHIodGhpcy5lbCwgXCJzZWxlY3RlZHRleHRcIikgfHwgdGhpcy5jb25maWcuc2VsZWN0ZWR0ZXh0O1xyXG4gICAgdGhpcy5kcm9wZG93biAgICAgICAgID0gbnVsbDtcclxuICAgIHRoaXMuc2VsZWN0aW9uTGlzdCAgICA9IG51bGw7XHJcbiAgICB0aGlzLm11bHRpcGxlICAgICAgICAgPSBhdHRyKHRoaXMuZWwsIFwibXVsdGlwbGVcIik7XHJcbiAgICB0aGlzLmRpc2FibGVkICAgICAgICAgPSBhdHRyKHRoaXMuZWwsIFwiZGlzYWJsZWRcIik7XHJcbiAgICB0aGlzLmNyZWF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlKCkge1xyXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLmVsLnN0eWxlLCB7XHJcbiAgICAgIG9wYWNpdHk6IFwiMFwiLFxyXG4gICAgICB3aWR0aDogXCIwXCIsXHJcbiAgICAgIHBhZGRpbmc6IFwiMFwiLFxyXG4gICAgICBoZWlnaHQ6IFwiMFwiLFxyXG4gICAgICBmb250U2l6ZTogXCIwXCIsXHJcbiAgICAgIG1pbkhlaWdodDogXCJhdXRvXCIsXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmRhdGEgPyB0aGlzLnByb2Nlc3NEYXRhKHRoaXMuZGF0YSkgOiB0aGlzLmV4dHJhY3REYXRhKCk7XHJcbiAgICB0aGlzLnJlbmRlckRyb3Bkb3duKCk7XHJcbiAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gIH1cclxuXHJcbiAgcHJvY2Vzc0RhdGEoZGF0YSkge1xyXG4gICAgdGhpcy5vcHRpb25zID0gZGF0YS5tYXAoKGl0ZW0pID0+ICh7XHJcbiAgICAgIGRhdGE6IGl0ZW0sXHJcbiAgICAgIGF0dHJpYnV0ZXM6IHtcclxuICAgICAgICBzZWxlY3RlZDogISFpdGVtLnNlbGVjdGVkLFxyXG4gICAgICAgIGRpc2FibGVkOiAhIWl0ZW0uZGlzYWJsZWQsXHJcbiAgICAgICAgb3B0Z3JvdXA6IGl0ZW0udmFsdWUgPT09IFwib3B0Z3JvdXBcIixcclxuICAgICAgfSxcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIGV4dHJhY3REYXRhKCkge1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IEFycmF5LmZyb20odGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKFwib3B0aW9uLG9wdGdyb3VwXCIpKTtcclxuICAgIGNvbnN0IGFsbE9wdGlvbnMgPSBbXTtcclxuICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9ucyA9IFtdO1xyXG5cclxuICAgIHRoaXMuZGF0YSA9IG9wdGlvbnMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgIGxldCBpdGVtRGF0YTtcclxuXHJcbiAgICAgIGlmIChpdGVtLnRhZ05hbWUgPT09IFwiT1BUR1JPVVBcIikge1xyXG4gICAgICAgIGl0ZW1EYXRhID0geyB0ZXh0OiBpdGVtLmxhYmVsLCB2YWx1ZTogXCJvcHRncm91cFwiIH07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IGl0ZW0uZGF0YXNldC5kaXNwbGF5ID8/IGl0ZW0uaW5uZXJUZXh0O1xyXG4gICAgICAgIGl0ZW1EYXRhID0ge1xyXG4gICAgICAgICAgdGV4dCxcclxuICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLFxyXG4gICAgICAgICAgZXh0cmE6IGl0ZW0uZGF0YXNldC5leHRyYSxcclxuICAgICAgICAgIHNlbGVjdGVkOiBpdGVtLmhhc0F0dHJpYnV0ZShcInNlbGVjdGVkXCIpLFxyXG4gICAgICAgICAgZGlzYWJsZWQ6IGl0ZW0uaGFzQXR0cmlidXRlKFwiZGlzYWJsZWRcIiksXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHtcclxuICAgICAgICBzZWxlY3RlZDogaXRlbS5oYXNBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiKSxcclxuICAgICAgICBkaXNhYmxlZDogaXRlbS5oYXNBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSxcclxuICAgICAgICBvcHRncm91cDogaXRlbS50YWdOYW1lID09PSBcIk9QVEdST1VQXCIsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBvcHRpb25PYmogPSB7IGRhdGE6IGl0ZW1EYXRhLCBhdHRyaWJ1dGVzLCBlbGVtZW50OiBudWxsIH07XHJcblxyXG4gICAgICBhbGxPcHRpb25zLnB1c2gob3B0aW9uT2JqKTtcclxuXHJcbiAgICAgIGlmIChhdHRyaWJ1dGVzLnNlbGVjdGVkKSBzZWxlY3RlZE9wdGlvbnMucHVzaChvcHRpb25PYmopO1xyXG5cclxuICAgICAgcmV0dXJuIGl0ZW1EYXRhO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5vcHRpb25zICAgICAgICAgID0gYWxsT3B0aW9ucztcclxuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zICA9IHNlbGVjdGVkT3B0aW9ucztcclxuICB9XHJcblxyXG4gIHJlbmRlckRyb3Bkb3duKCkge1xyXG4gICAgY29uc3QgY2xhc3NlcyA9IFtcclxuICAgICAgXCJuaWNlLXNlbGVjdFwiLFxyXG4gICAgICBhdHRyKHRoaXMuZWwsIFwiY2xhc3NcIikgfHwgXCJcIixcclxuICAgICAgdGhpcy5kaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCIsXHJcbiAgICAgIHRoaXMubXVsdGlwbGUgPyBcImhhcy1tdWx0aXBsZVwiIDogXCJcIixcclxuICAgIF0uZmlsdGVyKEJvb2xlYW4pO1xyXG5cclxuICAgIGNvbnN0IHNlYXJjaEh0bWwgPSB0aGlzLmNvbmZpZy5zZWFyY2hhYmxlXHJcbiAgICAgID8gYFxyXG4gICAgICA8ZGl2IGNsYXNzPVwibmljZS1zZWxlY3Qtc2VhcmNoLWJveFwiPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwibmljZS1zZWxlY3Qtc2VhcmNoXCIgcGxhY2Vob2xkZXI9XCIke3RoaXMuc2VhcmNodGV4dH0uLi5cIiB0aXRsZT1cInNlYXJjaFwiLz5cclxuICAgICAgPC9kaXY+XHJcbiAgICBgXHJcbiAgICAgIDogXCJcIjtcclxuXHJcbiAgICBjb25zdCBodG1sID0gYFxyXG4gICAgICA8ZGl2IGNsYXNzPVwiJHtjbGFzc2VzLmpvaW4oXCIgXCIpfVwiIHRhYmluZGV4PVwiJHt0aGlzLmRpc2FibGVkID8gXCJcIiA6IDB9XCI+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCIke3RoaXMubXVsdGlwbGUgPyBcIm11bHRpcGxlLW9wdGlvbnNcIiA6IFwiY3VycmVudFwifVwiPjwvc3Bhbj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwibmljZS1zZWxlY3QtZHJvcGRvd25cIj5cclxuICAgICAgICAgICR7c2VhcmNoSHRtbH1cclxuICAgICAgICAgIDx1bCBjbGFzcz1cImxpc3RcIj48L3VsPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIGA7XHJcblxyXG4gICAgdGhpcy5lbC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmVuZFwiLCBodG1sKTtcclxuXHJcbiAgICB0aGlzLmRyb3Bkb3duID0gdGhpcy5lbC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcblxyXG4gICAgdGhpcy5fcmVuZGVyU2VsZWN0ZWRJdGVtcygpO1xyXG5cclxuICAgIHRoaXMuX3JlbmRlckl0ZW1zKCk7XHJcbiAgfVxyXG5cclxuICBfcmVuZGVyU2VsZWN0ZWRJdGVtcygpIHtcclxuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgIGxldCBzZWxlY3RlZEh0bWwgPSBcIlwiO1xyXG5cclxuICAgICAgaWYgKFxyXG4gICAgICAgIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZHJvcGRvd24pLndpZHRoID09PSBcImF1dG9cIiB8fFxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLmxlbmd0aCA8IDJcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaCggKGl0ZW0sIGluZGV4LCBhcnJheSkgPT4ge1xyXG4gICAgICAgICAgbGV0IHRleHQgID0gaXRlbS5kYXRhLnRleHQ7XHJcblxyXG4gICAgICAgICAgaWYoaW5kZXggIT09IGFycmF5Lmxlbmd0aCAtMSApe1xyXG4gICAgICAgICAgICB0ZXh0ICs9IGAsIGA7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgc2VsZWN0ZWRIdG1sICs9IGA8c3BhbiBjbGFzcz1cImN1cnJlbnRcIj4ke3RleHR9PC9zcGFuPmA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNlbGVjdGVkSHRtbCA9IHNlbGVjdGVkSHRtbCB8fCB0aGlzLnBsYWNlaG9sZGVyO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNlbGVjdGVkSHRtbCA9IGAke3RoaXMuc2VsZWN0ZWRPcHRpb25zLmxlbmd0aH0gJHt0aGlzLnNlbGVjdGVkdGV4dH1gO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIubXVsdGlwbGUtb3B0aW9uc1wiKS5pbm5lckhUTUwgPSBzZWxlY3RlZEh0bWw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBodG1sID1cclxuICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5sZW5ndGggPiAwXHJcbiAgICAgICAgICA/IHRoaXMuc2VsZWN0ZWRPcHRpb25zWzBdLmRhdGEudGV4dFxyXG4gICAgICAgICAgOiB0aGlzLnBsYWNlaG9sZGVyO1xyXG5cclxuICAgICAgdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmN1cnJlbnRcIikuaW5uZXJIVE1MID0gaHRtbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9yZW5kZXJJdGVtcygpIHtcclxuICAgIGNvbnN0IHVsID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwidWxcIik7XHJcblxyXG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuXHJcbiAgICAgIGlmKHRoaXMubXVsdGlwbGUgJiYgdGhpcy5jb25maWcuc2hvd1NlbGVjdGVkSXRlbXMpe1xyXG4gICAgICAgIHRoaXMuX211bHRpcGxlTGlzdEFkZChpdGVtKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdWwuYXBwZW5kQ2hpbGQodGhpcy5fcmVuZGVySXRlbShpdGVtKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJJdGVtKG9wdGlvbikge1xyXG4gICAgY29uc3QgbGkgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuICAgIGxpLmlubmVySFRNTCAgPSBvcHRpb24uZGF0YS50ZXh0O1xyXG5cclxuICAgIGlmIChvcHRpb24uZGF0YS5leHRyYSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGxpLmFwcGVuZENoaWxkKHRoaXMuX3JlbmRlckl0ZW1FeHRyYShvcHRpb24uZGF0YS5leHRyYSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChvcHRpb24uYXR0cmlidXRlcy5vcHRncm91cCkge1xyXG4gICAgICBhZGRDbGFzcyhsaSwgXCJvcHRncm91cFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxpLnNldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIiwgb3B0aW9uLmRhdGEudmFsdWUpO1xyXG4gICAgICBjb25zdCBjbGFzc0xpc3QgPSBbXCJvcHRpb25cIl07XHJcbiAgICAgIGlmIChvcHRpb24uYXR0cmlidXRlcy5zZWxlY3RlZCkgY2xhc3NMaXN0LnB1c2goXCJzZWxlY3RlZFwiKTtcclxuICAgICAgaWYgKG9wdGlvbi5hdHRyaWJ1dGVzLmRpc2FibGVkKSBjbGFzc0xpc3QucHVzaChcImRpc2FibGVkXCIpO1xyXG4gICAgICBsaS5jbGFzc0xpc3QuYWRkKC4uLmNsYXNzTGlzdCk7XHJcbiAgICAgIGxpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4gdGhpcy5fb25JdGVtQ2xpY2tlZChvcHRpb24sIGUpKTtcclxuICAgIH1cclxuXHJcbiAgICBvcHRpb24uZWxlbWVudCA9IGxpO1xyXG5cclxuICAgIHJldHVybiBsaTtcclxuICB9XHJcblxyXG4gIF9yZW5kZXJJdGVtRXh0cmEoY29udGVudCkge1xyXG4gICAgY29uc3Qgc3BhbiAgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICBzcGFuLmlubmVySFRNTCAgPSBjb250ZW50O1xyXG4gICAgYWRkQ2xhc3Moc3BhbiwgXCJleHRyYVwiKTtcclxuXHJcbiAgICByZXR1cm4gc3BhbjtcclxuICB9XHJcblxyXG4gIHVwZGF0ZSgpIHtcclxuICAgIHRoaXMuZXh0cmFjdERhdGEoKTtcclxuXHJcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xyXG4gICAgICBjb25zdCBvcGVuID0gaGFzQ2xhc3ModGhpcy5kcm9wZG93biwgXCJvcGVuXCIpO1xyXG4gICAgICB0aGlzLmRyb3Bkb3duLnJlbW92ZSgpO1xyXG4gICAgICB0aGlzLmNyZWF0ZSgpO1xyXG4gICAgICBpZiAob3Blbikge1xyXG4gICAgICAgIHRyaWdnZXJDbGljayh0aGlzLmRyb3Bkb3duKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGF0dHIodGhpcy5lbCwgXCJkaXNhYmxlZFwiKSA/IHRoaXMuZGlzYWJsZSgpIDogdGhpcy5lbmFibGUoKTtcclxuICB9XHJcblxyXG4gIGRpc2FibGUoKSB7XHJcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGFkZENsYXNzKHRoaXMuZHJvcGRvd24sIFwiZGlzYWJsZWRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBlbmFibGUoKSB7XHJcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZHJvcGRvd24sIFwiZGlzYWJsZWRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMucmVzZXRTZWxlY3RWYWx1ZSgpO1xyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSBbXTtcclxuICAgIHRoaXMuX3JlbmRlclNlbGVjdGVkSXRlbXMoKTtcclxuICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICB0cmlnZ2VyQ2hhbmdlKHRoaXMuZWwpO1xyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIGlmKHRoaXMuc2VsZWN0aW9uTGlzdCl7XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uTGlzdC5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xyXG4gICAgICB0aGlzLmRyb3Bkb3duLnJlbW92ZSgpO1xyXG4gICAgICB0aGlzLmVsLnN0eWxlLmRpc3BsYXkgICA9IFwiXCI7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUub3BhY2l0eSAgID0gJyc7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUud2lkdGggICAgID0gJyc7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUucGFkZGluZyAgID0gJyc7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ICAgID0gJyc7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUuZm9udFNpemUgID0gJyc7XHJcbiAgICAgIHRoaXMuZWwuc3R5bGUubWluSGVpZ2h0ID0gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmb2N1cyh0YXJnZXQ9Jycpe1xyXG4gICAgY29uc3QgaXNPcGVuID0gaGFzQ2xhc3ModGhpcy5kcm9wZG93biwgXCJvcGVuXCIpO1xyXG5cclxuICAgIGlmICghaXNPcGVuKSB7XHJcbiAgICAgIGFkZENsYXNzKHRoaXMuZHJvcGRvd24sIFwib3BlblwiKTtcclxuICAgICAgdHJpZ2dlck1vZGFsT3Blbih0aGlzLmVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCA9PT0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLm11bHRpcGxlLW9wdGlvbnNcIikpIHtcclxuICAgICAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZHJvcGRvd24sIFwib3BlblwiKTtcclxuICAgICAgICAgIHRyaWdnZXJNb2RhbENsb3NlKHRoaXMuZWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZW1vdmVDbGFzcyh0aGlzLmRyb3Bkb3duLCBcIm9wZW5cIik7XHJcbiAgICAgICAgdHJpZ2dlck1vZGFsQ2xvc2UodGhpcy5lbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoaGFzQ2xhc3ModGhpcy5kcm9wZG93biwgXCJvcGVuXCIpKSB7XHJcbiAgICAgIGNvbnN0IHNlYXJjaCA9IHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5uaWNlLXNlbGVjdC1zZWFyY2hcIik7XHJcblxyXG4gICAgICBpZiAoc2VhcmNoKSB7XHJcbiAgICAgICAgc2VhcmNoLnZhbHVlID0gXCJcIjtcclxuICAgICAgICBzZWFyY2guZm9jdXMoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZm9jdXNlZCA9IHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5mb2N1c1wiKTtcclxuXHJcbiAgICAgIGlmIChmb2N1c2VkKSByZW1vdmVDbGFzcyhmb2N1c2VkLCBcImZvY3VzXCIpO1xyXG5cclxuICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuc2VsZWN0ZWRcIik7XHJcbiAgICAgIGlmIChzZWxlY3RlZCkgYWRkQ2xhc3Moc2VsZWN0ZWQsIFwiZm9jdXNcIik7XHJcblxyXG4gICAgICB0aGlzLmRyb3Bkb3duXHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCJ1bCBsaVwiKVxyXG4gICAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiAoaXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJcIikpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kcm9wZG93bi5mb2N1cygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdXBkYXRlU2VsZWN0KCl7XHJcbiAgICBjb25zb2xlLmxvZygndGVzdCcpO1xyXG4gICAgdGhpcy51cGRhdGUoKTtcclxuICB9XHJcblxyXG4gIGJpbmRFdmVudCgpIHtcclxuICAgIHRoaXMuZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB0aGlzLl9vbkNsaWNrZWQoZSkpO1xyXG4gICAgdGhpcy5kcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4gdGhpcy5fb25LZXlQcmVzc2VkKGUpKTtcclxuICAgIHRoaXMuZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzaW5cIiwgKCkgPT4gdHJpZ2dlckZvY3VzSW4odGhpcy5lbCkpO1xyXG4gICAgdGhpcy5kcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgKCkgPT4gdHJpZ2dlckZvY3VzT3V0KHRoaXMuZWwpKTtcclxuICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcihcImludmFsaWRcIiwgKCkgPT4gdGhpcy5fdHJpZ2dlclZhbGlkYXRpb25NZXNzYWdlKFwiaW52YWxpZFwiKSk7XHJcbiAgICB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKCkgPT4gdGhpcy51cGRhdGVTZWxlY3QoKSk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB0aGlzLl9vbkNsaWNrZWRPdXRzaWRlKGUpKTtcclxuXHJcbiAgICBpZiAodGhpcy5jb25maWcuc2VhcmNoYWJsZSkgdGhpcy5fYmluZFNlYXJjaEV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICBfYmluZFNlYXJjaEV2ZW50KCkge1xyXG4gICAgY29uc3Qgc2VhcmNoQm94ID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLm5pY2Utc2VsZWN0LXNlYXJjaFwiKTtcclxuICAgIGlmIChzZWFyY2hCb3gpIHtcclxuICAgICAgc2VhcmNoQm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7XHJcbiAgICAgIHNlYXJjaEJveC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHRoaXMuX29uU2VhcmNoQ2hhbmdlZChlKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfb25DbGlja2VkKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICB0aGlzLmZvY3VzKGUudGFyZ2V0KTtcclxuICB9XHJcblxyXG4gIF9vbkl0ZW1DbGlja2VkKG9wdGlvbiwgZSkge1xyXG4gICAgY29uc3Qgb3B0aW9uRWwgPSBlLnRhcmdldDtcclxuICAgIGlmICghaGFzQ2xhc3Mob3B0aW9uRWwsIFwiZGlzYWJsZWRcIikpIHtcclxuICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcclxuICAgICAgICBpZiAoaGFzQ2xhc3Mob3B0aW9uRWwsIFwic2VsZWN0ZWRcIikpIHtcclxuICAgICAgICAgIHJlbW92ZUNsYXNzKG9wdGlvbkVsLCBcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSB0aGlzLnNlbGVjdGVkT3B0aW9ucy5maWx0ZXIoXHJcbiAgICAgICAgICAgIChpdGVtKSA9PiBpdGVtICE9PSBvcHRpb25cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgIGBvcHRpb25bdmFsdWU9XCIke29wdGlvbkVsLmRhdGFzZXQudmFsdWV9XCJdYFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGlmIChvcHQpIHtcclxuICAgICAgICAgICAgb3B0LnJlbW92ZUF0dHJpYnV0ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBvcHQuc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLl9tdWx0aXBsZUxpc3RSZW1vdmUob3B0aW9uKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYWRkQ2xhc3Mob3B0aW9uRWwsIFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKG9wdGlvbik7XHJcblxyXG4gICAgICAgICAgaWYodGhpcy5jb25maWcuc2hvd1NlbGVjdGVkSXRlbXMpe1xyXG4gICAgICAgICAgICBvcHRpb24uYXR0cmlidXRlcy5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuX211bHRpcGxlTGlzdEFkZChvcHRpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCgoaXRlbSkgPT4gcmVtb3ZlQ2xhc3MoaXRlbS5lbGVtZW50LCBcInNlbGVjdGVkXCIpKTtcclxuXHJcbiAgICAgICAgYWRkQ2xhc3Mob3B0aW9uRWwsIFwic2VsZWN0ZWRcIik7XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW29wdGlvbl07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuX3JlbmRlclNlbGVjdGVkSXRlbXMoKTtcclxuXHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0VmFsdWUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFZhbHVlKHZhbHVlKSB7XHJcbiAgICBjb25zdCBzZWxlY3QgPSB0aGlzLmVsO1xyXG4gICAgbGV0IG5vU2VsZWN0ZWQgPSB0cnVlO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIGlucHV0IHR5cGVcclxuICAgIGlmIChzZWxlY3QubXVsdGlwbGUpIHtcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc2V0VmFsdWUgZXhwZWN0cyBhbiBhcnJheSBmb3IgbXVsdGlwbGUgc2VsZWN0IGVsZW1lbnRzJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhbHVlID0gdmFsdWUubWFwKFN0cmluZyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NldFZhbHVlIGV4cGVjdHMgYSBzaW5nbGUgdmFsdWUgZm9yIG5vbi1tdWx0aXBsZSBzZWxlY3QgZWxlbWVudHMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRWYWx1ZSBleHBlY3RzIGEgc3RyaW5nIG9yIG51bWJlciBmb3Igbm9uLW11bHRpcGxlIHNlbGVjdCBlbGVtZW50cycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YWx1ZSA9IFN0cmluZyh2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBvcHQgb2Ygc2VsZWN0Lm9wdGlvbnMpIHtcclxuICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gc2VsZWN0Lm11bHRpcGxlXHJcbiAgICAgICAgPyB2YWx1ZS5pbmNsdWRlcyhvcHQudmFsdWUpXHJcbiAgICAgICAgICA/IG9wdC52YWx1ZVxyXG4gICAgICAgICAgOiBudWxsXHJcbiAgICAgICAgOiB2YWx1ZTtcclxuICAgICAgaWYgKG9wdC52YWx1ZSA9PT0gY3VycmVudFZhbHVlICYmICFvcHQuZGlzYWJsZWQpIHtcclxuICAgICAgICBpZiAobm9TZWxlY3RlZCkge1xyXG4gICAgICAgICAgc2VsZWN0LnZhbHVlID0gY3VycmVudFZhbHVlO1xyXG4gICAgICAgICAgbm9TZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3B0LnNldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsIHRydWUpO1xyXG4gICAgICAgIG9wdC5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb3B0LnJlbW92ZUF0dHJpYnV0ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgIG9wdC5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG5vU2VsZWN0ZWQgJiYgIXNlbGVjdC5tdWx0aXBsZSAmJiBzZWxlY3Qub3B0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgc2VsZWN0Lm9wdGlvbnNbMF0uc2V0QXR0cmlidXRlKFwic2VsZWN0ZWRcIiwgdHJ1ZSk7XHJcbiAgICAgIHNlbGVjdC5vcHRpb25zWzBdLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgc2VsZWN0LnZhbHVlID0gc2VsZWN0Lm9wdGlvbnNbMF0udmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGUoKTtcclxuICB9XHJcblxyXG4gIGdldFZhbHVlKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ID0gdGhpcy5lbDtcclxuICAgIGlmICghc2VsZWN0Lm11bHRpcGxlKSByZXR1cm4gc2VsZWN0LnZhbHVlO1xyXG5cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHNlbGVjdC5vcHRpb25zKVxyXG4gICAgICAuZmlsdGVyKChvcHQpID0+IG9wdC5zZWxlY3RlZClcclxuICAgICAgLm1hcCgob3B0KSA9PiBvcHQudmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlU2VsZWN0VmFsdWUoKSB7XHJcbiAgICBpZiAodGhpcy5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmVsLnZhbHVlID0gdGhpcy5zZWxlY3RlZE9wdGlvbnNbMF0uZGF0YS52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZWxlY3QgPSB0aGlzLmVsO1xyXG5cclxuICAgIC8vIEZJcnN0IG1hcmsgYWxsIG9wdGlvbnMgYXMgbm90IHNlbGVjdGVkXHJcbiAgICBzZWxlY3QucXVlcnlTZWxlY3RvckFsbChcIm9wdGlvblwiKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKFwic2VsZWN0ZWRcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBNYXJrIHRoZSBzZWxlY3RlZCBvcHRpb25zIGFzIHNlbGVjdGVkIGluIHRoZSBzZWxlY3QgZWxlbWVudFxyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaCggaXRlbSA9PiB7XHJcbiAgICAgIGxldCBlbCA9IHNlbGVjdC5xdWVyeVNlbGVjdG9yKGBvcHRpb25bdmFsdWU9XCIke2l0ZW0uZGF0YS52YWx1ZX1cIl1gKTtcclxuXHJcbiAgICAgIGlmIChlbCl7XHJcbiAgICAgICAgLy9DaGFuZ2UgaXQsIGNhdXNlIGl0IHdvcmtzIG1vcmUgY29ycmVjdGx5LlxyXG4gICAgICAgIGVsLnNldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsIFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgZWwuc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0cmlnZ2VyQ2hhbmdlKHRoaXMuZWwpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRTZWxlY3RWYWx1ZSgpIHtcclxuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IHRoaXMuZWw7XHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICBjb25zdCBlbCA9IHNlbGVjdC5xdWVyeVNlbGVjdG9yKGBvcHRpb25bdmFsdWU9XCIke2l0ZW0uZGF0YS52YWx1ZX1cIl1gKTtcclxuICAgICAgICBpZiAoZWwpIHtcclxuICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgZWwuc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkT3B0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuZWwuc2VsZWN0ZWRJbmRleCA9IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIHRyaWdnZXJDaGFuZ2UodGhpcy5lbCk7XHJcbiAgfVxyXG5cclxuICBfb25DbGlja2VkT3V0c2lkZShlKSB7XHJcbiAgICBpZiAoIXRoaXMuZHJvcGRvd24uY29udGFpbnMoZS50YXJnZXQpKSB7XHJcbiAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZHJvcGRvd24sIFwib3BlblwiKTtcclxuICAgICAgdHJpZ2dlck1vZGFsQ2xvc2UodGhpcy5lbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfb25LZXlQcmVzc2VkKGUpIHtcclxuICAgIGNvbnN0IGZvY3VzZWRPcHRpb24gPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZm9jdXNcIik7XHJcbiAgICBjb25zdCBpc09wZW4gICAgICAgID0gaGFzQ2xhc3ModGhpcy5kcm9wZG93biwgXCJvcGVuXCIpO1xyXG5cclxuICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICAgIGlzT3BlbiA/IHRyaWdnZXJDbGljayhmb2N1c2VkT3B0aW9uKSA6IHRyaWdnZXJDbGljayh0aGlzLmRyb3Bkb3duKTtcclxuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSA0MCkge1xyXG4gICAgICBpZiAoIWlzT3Blbikge1xyXG4gICAgICAgIHRyaWdnZXJDbGljayh0aGlzLmRyb3Bkb3duKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBuZXh0ID0gdGhpcy5fZmluZE5leHQoZm9jdXNlZE9wdGlvbik7XHJcbiAgICAgICAgaWYgKG5leHQpIHtcclxuICAgICAgICAgIGlmIChmb2N1c2VkT3B0aW9uKSByZW1vdmVDbGFzcyhmb2N1c2VkT3B0aW9uLCBcImZvY3VzXCIpO1xyXG4gICAgICAgICAgYWRkQ2xhc3MobmV4dCwgXCJmb2N1c1wiKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IDM4KSB7XHJcbiAgICAgIGlmICghaXNPcGVuKSB7XHJcbiAgICAgICAgdHJpZ2dlckNsaWNrKHRoaXMuZHJvcGRvd24pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLl9maW5kUHJldihmb2N1c2VkT3B0aW9uKTtcclxuICAgICAgICBpZiAocHJldikge1xyXG4gICAgICAgICAgaWYgKGZvY3VzZWRPcHRpb24pIHJlbW92ZUNsYXNzKGZvY3VzZWRPcHRpb24sIFwiZm9jdXNcIik7XHJcbiAgICAgICAgICBhZGRDbGFzcyhwcmV2LCBcImZvY3VzXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gMjcgJiYgaXNPcGVuKSB7XHJcbiAgICAgIHRyaWdnZXJDbGljayh0aGlzLmRyb3Bkb3duKTtcclxuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSAzMiAmJiBpc09wZW4pIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZvY3VzID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKCcuZm9jdXMnKTtcclxuICAgIGlmIChmb2N1cykge1xyXG4gICAgICBmb2N1cy5zY3JvbGxJbnRvVmlldyh7IGJsb2NrOiAnY2VudGVyJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBfZmluZE5leHQoZWwpIHtcclxuICAgIGxldCBuZXh0RWwgPSBlbFxyXG4gICAgICA/IGVsLm5leHRFbGVtZW50U2libGluZ1xyXG4gICAgICA6IHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5saXN0IC5vcHRpb25cIik7XHJcbiAgICB3aGlsZSAobmV4dEVsKSB7XHJcbiAgICAgIGlmICghaGFzQ2xhc3MobmV4dEVsLCBcImRpc2FibGVkXCIpICYmIG5leHRFbC5zdHlsZS5kaXNwbGF5ICE9PSBcIm5vbmVcIilcclxuICAgICAgICByZXR1cm4gbmV4dEVsO1xyXG4gICAgICBuZXh0RWwgPSBuZXh0RWwubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgX2ZpbmRQcmV2KGVsKSB7XHJcbiAgICBsZXQgcHJldkVsID0gZWxcclxuICAgICAgPyBlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nXHJcbiAgICAgIDogdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmxpc3QgLm9wdGlvbjpsYXN0LWNoaWxkXCIpO1xyXG4gICAgd2hpbGUgKHByZXZFbCkge1xyXG4gICAgICBpZiAoIWhhc0NsYXNzKHByZXZFbCwgXCJkaXNhYmxlZFwiKSAmJiBwcmV2RWwuc3R5bGUuZGlzcGxheSAhPT0gXCJub25lXCIpXHJcbiAgICAgICAgcmV0dXJuIHByZXZFbDtcclxuICAgICAgcHJldkVsID0gcHJldkVsLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBfb25TZWFyY2hDaGFuZ2VkKGUpIHtcclxuICAgIGNvbnN0IHRleHQgPSBlLnRhcmdldC52YWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIGlmICh0ZXh0ID09PSBcIlwiKSB7XHJcbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChpdGVtKSA9PiAoaXRlbS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiKSk7XHJcbiAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKHRoaXMuZHJvcGRvd24sIFwib3BlblwiKSkge1xyXG4gICAgICBjb25zdCBtYXRjaFJlZyA9IG5ldyBSZWdFeHAodGV4dCk7XHJcbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgaXRlbS5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBtYXRjaFJlZy50ZXN0KGl0ZW0uZGF0YS50ZXh0LnRvTG93ZXJDYXNlKCkpXHJcbiAgICAgICAgICA/IFwiXCJcclxuICAgICAgICAgIDogXCJub25lXCI7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZHJvcGRvd25cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9jdXNcIilcclxuICAgICAgLmZvckVhY2goKGl0ZW0pID0+IHJlbW92ZUNsYXNzKGl0ZW0sIFwiZm9jdXNcIikpO1xyXG5cclxuICAgIGNvbnN0IGZpcnN0RWwgPSB0aGlzLl9maW5kTmV4dChudWxsKTtcclxuXHJcbiAgICBpZiAoZmlyc3RFbCkgYWRkQ2xhc3MoZmlyc3RFbCwgXCJmb2N1c1wiKTtcclxuICB9XHJcblxyXG4gIF90cmlnZ2VyVmFsaWRhdGlvbk1lc3NhZ2UodHlwZSkge1xyXG4gICAgaWYgKHR5cGUgPT09IFwiaW52YWxpZFwiKSB7XHJcbiAgICAgIGFkZENsYXNzKHRoaXMuZHJvcGRvd24sIFwiaW52YWxpZFwiKTtcclxuICAgICAgcmVtb3ZlQ2xhc3ModGhpcy5kcm9wZG93biwgXCJ2YWxpZFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFkZENsYXNzKHRoaXMuZHJvcGRvd24sIFwidmFsaWRcIik7XHJcbiAgICAgIHJlbW92ZUNsYXNzKHRoaXMuZHJvcGRvd24sIFwiaW52YWxpZFwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9tdWx0aXBsZUxpc3RBZGQob3B0aW9uKSB7XHJcbiAgXHJcbiAgICBpZihvcHRpb24uZGF0YS5kaXNhYmxlZCB8fCBvcHRpb24uZGF0YS52YWx1ZSA9PSBcIlwiIHx8ICFvcHRpb24uYXR0cmlidXRlcy5zZWxlY3RlZCl7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZih0aGlzLnNlbGVjdGlvbkxpc3QgPT0gbnVsbCl7XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uTGlzdFx0IFx0XHQ9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uTGlzdC5jbGFzc0xpc3QuYWRkKCdzZWxlY3Qtc2VsZWN0aW9uLWxpc3QnKTtcclxuXHJcbiAgICAgIHRoaXMuZWwuYWZ0ZXIodGhpcy5zZWxlY3Rpb25MaXN0KTtcclxuICAgIH1lbHNlIGlmKHRoaXMuc2VsZWN0aW9uTGlzdC5xdWVyeVNlbGVjdG9yKGBbZGF0YS12YWx1ZT1cIiR7b3B0aW9uLmRhdGEudmFsdWV9XCJdYCkgIT0gbnVsbCl7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbGlcdCBcdFx0PSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgbGkuY2xhc3NMaXN0LmFkZCgnc2VsZWN0LXNlbGVjdGlvbicpO1xyXG5cclxuICAgIGxpLmRhdGFzZXQudmFsdWUgPSBvcHRpb24uZGF0YS52YWx1ZTtcclxuXHJcbiAgICBsZXQgaHRtbFx0ICA9IGBcclxuICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJzbWFsbCByZW1vdmUtc2VsZWN0LXNlbGVjdGlvblwiPlxyXG4gICAgICAgIDxzcGFuIGNsYXNzPSdyZW1vdmUtc2VsZWN0LXNlbGVjdGlvbic+w5c8L3NwYW4+XHJcbiAgICAgIDwvYnV0dG9uPlxyXG4gICAgYDtcclxuXHJcbiAgICAvLyBBZGRcclxuICAgIGh0bWwgICArPSBgPHNwYW4gY2xhc3M9J3NlbGVjdGVkLW5hbWUnPiR7b3B0aW9uLmRhdGEudGV4dH08L3NwYW4+YFxyXG5cclxuICAgIGxpLmlubmVySFRNTFx0PSBodG1sO1xyXG5cclxuICAgIHRoaXMuc2VsZWN0aW9uTGlzdC5hcHBlbmRDaGlsZChsaSk7XHJcblxyXG4gICAgbGkucXVlcnlTZWxlY3RvckFsbCgnLnJlbW92ZS1zZWxlY3Qtc2VsZWN0aW9uJykuZm9yRWFjaChlbD0+IGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9tdWx0aXBsZUxpc3RSZW1vdmUuYmluZCh0aGlzKSkpO1xyXG4gIH1cclxuXHJcbiAgX211bHRpcGxlTGlzdFJlbW92ZSh0YXJnZXQpIHtcclxuXHJcbiAgICBpZih0YXJnZXQudGFyZ2V0ICE9IG51bGwpe1xyXG4gICAgICB0YXJnZXQgID0gdGFyZ2V0LnRhcmdldDtcclxuICAgIH1cclxuXHJcbiAgICBpZih0YXJnZXQuZGF0YSA9PSB1bmRlZmluZWQpe1xyXG4gICAgICB0YXJnZXQuY2xvc2VzdCgnbGkuc2VsZWN0LXNlbGVjdGlvbicpLnJlbW92ZSgpO1xyXG5cclxuICAgICAgbGV0IHBhcmVudCAgPSB0YXJnZXQuY2xvc2VzdCgnbGkuc2VsZWN0LXNlbGVjdGlvbicpO1xyXG5cclxuICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4ge1xyXG4gICAgICAgIGlmKG9wdGlvbi5kYXRhLnZhbHVlID09IHBhcmVudC5kYXRhc2V0LnZhbHVlKXtcclxuICAgICAgICAgIHJlbW92ZUNsYXNzKG9wdGlvbi5lbGVtZW50LCBcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuc3BsaWNlKHRoaXMuc2VsZWN0ZWRPcHRpb25zLmluZGV4T2Yob3B0aW9uKSwgMSk7XHJcbiAgICAgICAgICB2YXIgb3B0ID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKGBvcHRpb25bdmFsdWU9XCIke29wdGlvbi5kYXRhLnZhbHVlfVwiXWApO1xyXG4gICAgICAgICAgb3B0LnJlbW92ZUF0dHJpYnV0ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgIG9wdC5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fcmVuZGVyU2VsZWN0ZWRJdGVtcygpO1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKHRhcmdldC5lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSl7XHJcbiAgICAgIGNvbnNvbGUubG9nKHRhcmdldCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcGFyZW50ICA9IHRoaXMuZWwucGFyZW50RWxlbWVudDtcclxuICAgIFxyXG4gICAgbGV0IHVsICAgICAgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLnNlbGVjdC1zZWxlY3Rpb24tbGlzdCcpO1xyXG4gICAgXHJcbiAgICB0YXJnZXQgID0gdWwucXVlcnlTZWxlY3RvcihgW2RhdGEtdmFsdWU9XCIke3RhcmdldC5kYXRhLnZhbHVlfVwiXWApO1xyXG5cclxuICAgIGlmKHVsICE9IG51bGwgJiYgdGFyZ2V0ICE9IG51bGwpe1xyXG4gICAgICB0YXJnZXQucmVtb3ZlKCk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTmljZVNlbGVjdDtcclxuZXhwb3J0IGZ1bmN0aW9uIGJpbmQoZWwsIG9wdGlvbnMpIHtcclxuICByZXR1cm4gbmV3IE5pY2VTZWxlY3QoZWwsIG9wdGlvbnMpO1xyXG59Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///462\n\n}')}},__webpack_require__={d:(c,l)=>{for(var t in l)__webpack_require__.o(l,t)&&!__webpack_require__.o(c,t)&&Object.defineProperty(c,t,{enumerable:!0,get:l[t]})},o:(c,l)=>Object.prototype.hasOwnProperty.call(c,l),r:c=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})}},__webpack_exports__={};return __webpack_modules__[462](0,__webpack_exports__,__webpack_require__),__webpack_exports__})());