!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("window")):"function"==typeof define&&define.amd?define(["window"],t):"object"==typeof exports?exports.NiceSelect=t(require("window")):e.NiceSelect=t(e.window)}(this,(function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"bind",(function(){return u}));n(2);function i(e,t){t||(t=document.createEvent("MouseEvents")).initEvent("click",!0,!1),e.dispatchEvent(t)}function o(e){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),e.dispatchEvent(t)}function s(e,t){return e.getAttribute(t)}function r(e,t){return!!e&&e.classList.contains(t)}function d(e,t){if(e)return e.classList.add(t)}function l(e,t){if(e)return e.classList.remove(t)}function c(e,t){var n=e.getBoundingClientRect(),i=n.bottom,o=(n.height,n.top),s=t.getBoundingClientRect();return o>=s.top&&i<=s.bottom}var a={data:null,searchable:!1};function p(e,t){this.el=e,this.config=Object.assign({},a,t||{}),this.data=this.config.data,this.selectedOptions=[],this.placeholder=s(this.el,"placeholder")||this.config.placeholder||"Select an option",this.dropdown=null,this.multiple=s(this.el,"multiple"),this.disabled=s(this.el,"disabled"),this.create()}function u(e,t){return new p(e,t)}p.prototype.create=function(){this.el.style.display="none",this.data?this.processData(this.data):this.extractData(),this.renderDropdown(),this.bindEvent()},p.prototype.processData=function(e){var t=[];e.forEach((function(e){t.push({data:e,attributes:{selected:!1,disabled:!1,display:!0}})})),this.options=t},p.prototype.extractData=function(){var e=this,t=this.el.querySelectorAll("option"),n=[],i=[],o=[];t.forEach((function(t){var o={text:t.innerText,value:t.value},s={selected:null!=t.getAttribute("selected")||t.value==e.el.value,disabled:null!=t.getAttribute("disabled"),display:!0};n.push(o),i.push({data:o,attributes:s})})),this.data=n,this.options=i,this.options.forEach((function(e){e.attributes.selected&&o.push(e)})),this.selectedOptions=o},p.prototype.renderDropdown=function(){var e=["nice-select",s(this.el,"class")||"",this.disabled?"disabled":"",this.multiple?"has-multiple":""],t='<div class="'.concat(e.join(" "),'" tabindex="').concat(this.disabled?null:0,'">\n  <span class="').concat(this.multiple?"multiple-options":"current",'"></span>\n  <div class="nice-select-dropdown">\n  ').concat(this.config.searchable?'<div class="nice-select-search-box">\n<input type="text" class="nice-select-search" placeholder="Search..."/>\n</div>':"",'\n  <ul class="list"></ul>\n  </div></div>\n');this.el.insertAdjacentHTML("afterend",t),this.dropdown=this.el.nextElementSibling,this._renderSelectedItems(),this._renderItems()},p.prototype._renderSelectedItems=function(){if(this.multiple){var e="";this.selectedOptions.forEach((function(t){e+='<span class="current">'.concat(t.data.text,"</span>")})),e=""==e?this.placeholder:e,this.dropdown.querySelector(".multiple-options").innerHTML=e}else{var t=this.selectedOptions.length>0?this.selectedOptions[0].data.text:this.placeholder;this.dropdown.querySelector(".current").innerHTML=t}},p.prototype._renderItems=function(){var e=this,t=this.dropdown.querySelector("ul");t.scrollTop=0,t.innerHTML="",this.options.forEach((function(n){n.display&&t.appendChild(e._renderItem(n))}))},p.prototype._renderItem=function(e){var t,n=this,i=document.createElement("li");i.setAttribute("data-value",e.data.value);var o=["option",e.attributes.selected?"selected":null,e.attributes.disabled?"disabled":null];return(t=i.classList).add.apply(t,o),i.innerHTML=e.data.text,i.addEventListener("click",(function(t){return n._onItemSelected(e,t)})),i.addEventListener("select",(function(t){return n._onItemSelected(e,t)})),e.element=i,i},p.prototype.update=function(){if(this.extractData(),this.dropdown){var e=r(this.dropdown,"open");this.dropdown.parentNode.removeChild(this.dropdown),this.create(),e&&i(this.dropdown)}},p.prototype.focus=function(){if(this.dropdown.classList.toggle("open"),this.dropdown.querySelector("ul").scrollTop=0,this.dropdown.classList.contains("open")){var e=this.dropdown.querySelector(".nice-select-search");e&&(e.value="",e.focus());var t=this.dropdown.querySelector(".focus");l(t,"focus"),d(t=this.dropdown.querySelector(".selected"),"focus");for(var n=0;n<this.options.length;n++)this.options[n].display=!0;this._renderItems()}else this.dropdown.focus()},p.prototype.disable=function(){this.disabled||(this.disabled=!0,d(this.dropdown,"disabled"))},p.prototype.enable=function(){this.disabled&&(this.disabled=!1,l(this.dropdown,"disabled"))},p.prototype.clear=function(){this.selectedOptions=[],this._renderSelectedItems(),this.updateSelectValue(),o(this.el)},p.prototype.destroy=function(){this.dropdown&&(this.dropdown.parentNode.removeChild(this.dropdown),this.el.style.display="")},p.prototype.bindEvent=function(){this.dropdown.addEventListener("click",this._onClicked.bind(this)),this.dropdown.addEventListener("keydown",this._onKeyPressed.bind(this)),e.addEventListener("click",this._onClickedOutside.bind(this)),this.config.searchable&&this._bindSearchEvent()},p.prototype._bindSearchEvent=function(){var e=this.dropdown.querySelector(".nice-select-search");e&&e.addEventListener("click",(function(e){return e.stopPropagation(),!1})),e.addEventListener("input",this._onSearchChanged.bind(this))},p.prototype._onClicked=function(e){this.focus()},p.prototype._onItemSelected=function(e,t){var n=(t=t.detail||t).target;r(n,"disabled")||(this.dropdown.classList.remove("open"),this.multiple?r(n,"selected")||(d(n,"selected"),this.selectedOptions.push(e)):(this.selectedOptions.forEach((function(e){l(e.element,"selected")})),d(n,"selected"),this.selectedOptions=[e]),this.dispatchOnChanged(t),this._renderSelectedItems(),this.updateSelectValue())},p.prototype.dispatchOnChanged=function(e){if(this.config.onChanged){var t=this.selectedOptions.map((function(e){return e.data.value}));this.config.onChanged(t,e)}},p.prototype.updateSelectValue=function(){this.multiple?this.selectedOptions.each((function(e){var t=this.el.querySelector('option[value="'+e.data.value+'"]');t&&t.setAttribute("selected",!0)})):this.selectedOptions.length>0&&(this.el.value=this.selectedOptions[0].data.value),o(this.el)},p.prototype._onClickedOutside=function(e){this.dropdown.contains(e.target)||this.dropdown.classList.remove("open")},p.prototype._onKeyPressed=function(e){e.preventDefault();var t=this.dropdown.querySelector(".focus"),n=this.dropdown.classList.contains("open");if(13==e.keyCode)n?i(t,new CustomEvent("select",{detail:e})):i(this.dropdown);else if(40==e.keyCode){if(n){var o=this._findNext(t);if(o)l(this.dropdown.querySelector(".focus"),"focus"),d(o,"focus"),c(o,o.parentElement)||(o.parentElement.scrollTop+=o.offsetHeight)}else i(this.dropdown);e.preventDefault()}else if(38==e.keyCode){if(n){var s=this._findPrev(t);if(s)l(this.dropdown.querySelector(".focus"),"focus"),d(s,"focus"),c(s,s.parentElement)||(s.parentElement.scrollTop-=s.offsetHeight)}else i(this.dropdown);e.preventDefault()}else 27==e.keyCode&&n&&i(this.dropdown);return!1},p.prototype._findNext=function(e){for(e=e?e.nextElementSibling:this.dropdown.querySelector(".list .option");e;){if(!r(e,"disabled")&&"none"!=e.style.display)return e;e=e.nextElementSibling}return null},p.prototype._findPrev=function(e){for(e=e?e.previousElementSibling:this.dropdown.querySelector(".list .option:last-child");e;){if(!r(e,"disabled")&&"none"!=e.style.display)return e;e=e.previousElementSibling}return null},p.prototype._onSearchChanged=function(e){e.preventDefault();var t=this.dropdown.classList.contains("open"),n=e.target.value;if(""==(n=n.toLowerCase()))this.options.forEach((function(e){e.display=!0})),this._renderItems();else if(t){var i=new RegExp(n);this.options.forEach((function(e){var t=e.data.text.toLowerCase(),n=i.test(t);e.display=n})),this._renderItems()}this.dropdown.querySelectorAll(".focus").forEach((function(e){l(e,"focus")})),d(this._findNext(null),"focus")}}.call(this,n(1))},function(t,n){t.exports=e},function(e,t,n){}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9OaWNlU2VsZWN0L3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9OaWNlU2VsZWN0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL05pY2VTZWxlY3QvLi9uaWNlLXNlbGVjdDIuanMiLCJ3ZWJwYWNrOi8vTmljZVNlbGVjdC9leHRlcm5hbCBcIndpbmRvd1wiIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMV9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInRyaWdnZXJFdmVudCIsImVsIiwiZXZlbnQiLCJkb2N1bWVudCIsImNyZWF0ZUV2ZW50IiwiaW5pdEV2ZW50IiwiZGlzcGF0Y2hFdmVudCIsInRyaWdnZXJDaGFuZ2UiLCJhdHRyIiwiZ2V0QXR0cmlidXRlIiwiaGFzQ2xhc3MiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFkZENsYXNzIiwiYWRkIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmUiLCJpc1Njcm9sbGVkSW50b1ZpZXciLCJlbGUiLCJjb250YWluZXIiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJib3R0b20iLCJ0b3AiLCJoZWlnaHQiLCJjb250YWluZXJSZWN0IiwiZGVmYXVsdE9wdGlvbnMiLCJkYXRhIiwic2VhcmNoYWJsZSIsIk5pY2VTZWxlY3QiLCJlbGVtZW50Iiwib3B0aW9ucyIsImNvbmZpZyIsImFzc2lnbiIsInNlbGVjdGVkT3B0aW9ucyIsInBsYWNlaG9sZGVyIiwiZHJvcGRvd24iLCJtdWx0aXBsZSIsImRpc2FibGVkIiwic3R5bGUiLCJkaXNwbGF5IiwicHJvY2Vzc0RhdGEiLCJleHRyYWN0RGF0YSIsInJlbmRlckRyb3Bkb3duIiwiYmluZEV2ZW50IiwiZm9yRWFjaCIsIml0ZW0iLCJwdXNoIiwiYXR0cmlidXRlcyIsInNlbGVjdGVkIiwicXVlcnlTZWxlY3RvckFsbCIsImFsbE9wdGlvbnMiLCJpdGVtRGF0YSIsInRleHQiLCJpbm5lclRleHQiLCJjbGFzc2VzIiwiaHRtbCIsImpvaW4iLCJpbnNlcnRBZGphY2VudEhUTUwiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJfcmVuZGVyU2VsZWN0ZWRJdGVtcyIsIl9yZW5kZXJJdGVtcyIsInNlbGVjdGVkSHRtbCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJsZW5ndGgiLCJ1bCIsInNjcm9sbFRvcCIsImFwcGVuZENoaWxkIiwiX3JlbmRlckl0ZW0iLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJfb25JdGVtU2VsZWN0ZWQiLCJ1cGRhdGUiLCJvcGVuIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiZm9jdXMiLCJ0b2dnbGUiLCJzZWFyY2giLCJkaXNhYmxlIiwiZW5hYmxlIiwiY2xlYXIiLCJ1cGRhdGVTZWxlY3RWYWx1ZSIsImRlc3Ryb3kiLCJfb25DbGlja2VkIiwiX29uS2V5UHJlc3NlZCIsIndpbmRvdyIsIl9vbkNsaWNrZWRPdXRzaWRlIiwiX2JpbmRTZWFyY2hFdmVudCIsInNlYXJjaEJveCIsInN0b3BQcm9wYWdhdGlvbiIsIl9vblNlYXJjaENoYW5nZWQiLCJvcHRpb25FbCIsImRldGFpbCIsInRhcmdldCIsImRpc3BhdGNoT25DaGFuZ2VkIiwib25DaGFuZ2VkIiwidmFsdWVzIiwibWFwIiwiZWFjaCIsInByZXZlbnREZWZhdWx0IiwiZm9jdXNlZE9wdGlvbiIsImtleUNvZGUiLCJDdXN0b21FdmVudCIsIm5leHQiLCJfZmluZE5leHQiLCJwYXJlbnRFbGVtZW50Iiwib2Zmc2V0SGVpZ2h0IiwicHJldiIsIl9maW5kUHJldiIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJ0b0xvd2VyQ2FzZSIsIm1hdGNoUmVnIiwiUmVnRXhwIiwib3B0aW9uVGV4dCIsIm1hdGNoZWQiLCJ0ZXN0Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUEyQ0EsRUFBTUMsR0FDMUIsaUJBQVpDLFNBQTBDLGlCQUFYQyxPQUN4Q0EsT0FBT0QsUUFBVUQsRUFBUUcsUUFBUSxXQUNSLG1CQUFYQyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sQ0FBQyxVQUFXSixHQUNPLGlCQUFaQyxRQUNkQSxRQUFvQixXQUFJRCxFQUFRRyxRQUFRLFdBRXhDSixFQUFpQixXQUFJQyxFQUFRRCxFQUFhLFFBUjVDLENBU0dPLE1BQU0sU0FBU0MsR0FDbEIsTyxZQ1RFLElBQUlDLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVULFFBR25DLElBQUlDLEVBQVNNLEVBQWlCRSxHQUFZLENBQ3pDQyxFQUFHRCxFQUNIRSxHQUFHLEVBQ0hYLFFBQVMsSUFVVixPQU5BWSxFQUFRSCxHQUFVSSxLQUFLWixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTUSxHQUcvRFAsRUFBT1UsR0FBSSxFQUdKVixFQUFPRCxRQTBEZixPQXJEQVEsRUFBb0JNLEVBQUlGLEVBR3hCSixFQUFvQk8sRUFBSVIsRUFHeEJDLEVBQW9CUSxFQUFJLFNBQVNoQixFQUFTaUIsRUFBTUMsR0FDM0NWLEVBQW9CVyxFQUFFbkIsRUFBU2lCLElBQ2xDRyxPQUFPQyxlQUFlckIs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QUFZOEIsRUFBTSxZQUlwQmhDLEVBRGNuRCxLQUFLa0osVUFBVSxNQUNYLFcsK0JDbGRwQnRKLEVBQU9ELFFBQVVNLEciLCJmaWxlIjoianMvbmljZS1zZWxlY3QyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwid2luZG93XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtcIndpbmRvd1wiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJOaWNlU2VsZWN0XCJdID0gZmFjdG9yeShyZXF1aXJlKFwid2luZG93XCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJOaWNlU2VsZWN0XCJdID0gZmFjdG9yeShyb290W1wid2luZG93XCJdKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzFfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiL1wiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgXCIuLi9zY3NzL25pY2Utc2VsZWN0Mi5zY3NzXCI7XG5cbi8vIHV0aWxpdHkgZnVuY3Rpb25zXG5mdW5jdGlvbiB0cmlnZ2VyRXZlbnQoZWwsIGV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHtcbiAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiTW91c2VFdmVudHNcIik7XG4gICAgZXZlbnQuaW5pdEV2ZW50KFwiY2xpY2tcIiwgdHJ1ZSwgZmFsc2UpO1xuICB9XG4gIGVsLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xufVxuXG5mdW5jdGlvbiB0cmlnZ2VyQ2hhbmdlKGVsKSB7XG4gIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiSFRNTEV2ZW50c1wiKTtcbiAgZXZlbnQuaW5pdEV2ZW50KFwiY2hhbmdlXCIsIHRydWUsIGZhbHNlKTtcbiAgZWwuZGlzcGF0Y2hFdmVudChldmVudCk7XG59XG5cbmZ1bmN0aW9uIGF0dHIoZWwsIGtleSkge1xuICByZXR1cm4gZWwuZ2V0QXR0cmlidXRlKGtleSk7XG59XG5cbmZ1bmN0aW9uIGRhdGEoZWwsIGtleSkge1xuICByZXR1cm4gZWwuZ2V0QXR0cmlidXRlKFwiZGF0YS1cIiArIGtleSk7XG59XG5cbmZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgaWYgKGVsKSByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSk7XG4gIGVsc2UgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBhZGRDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gIGlmIChlbCkgcmV0dXJuIGVsLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xuICBpZiAoZWwpIHJldHVybiBlbC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG59XG5cbmZ1bmN0aW9uIGlzU2Nyb2xsZWRJbnRvVmlldyhlbGUsIGNvbnRhaW5lcikge1xuICBjb25zdCB7IGJvdHRvbSwgaGVpZ2h0LCB0b3AgfSA9IGVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICByZXR1cm4gdG9wID49IGNvbnRhaW5lclJlY3QudG9wICYmIGJvdHRvbSA8PSBjb250YWluZXJSZWN0LmJvdHRvbTtcbn1cblxudmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICBkYXRhOiBudWxsLFxuICBzZWFyY2hhYmxlOiBmYWxzZSxcbn07XG5cbmZ1bmN0aW9uIE5pY2VTZWxlY3QoZWxlbWVudCwgb3B0aW9ucykge1xuICB0aGlzLmVsID0gZWxlbWVudDtcbiAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7XG5cbiAgdGhpcy5kYXRhID0gdGhpcy5jb25maWcuZGF0YTtcbiAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSBbXTtcblxuICB0aGlzLnBsYWNlaG9sZGVyID1cbiAgICBhdHRyKHRoaXMuZWwsIFwicGxhY2Vob2xkZXJcIikgfHxcbiAgICB0aGlzLmNvbmZpZy5wbGFjZWhvbGRlciB8fFxuICAgIFwiU2VsZWN0IGFuIG9wdGlvblwiO1xuXG4gIHRoaXMuZHJvcGRvd24gPSBudWxsO1xuICB0aGlzLm11bHRpcGxlID0gYXR0cih0aGlzLmVsLCBcIm11bHRpcGxlXCIpO1xuICB0aGlzLmRpc2FibGVkID0gYXR0cih0aGlzLmVsLCBcImRpc2FibGVkXCIpO1xuXG4gIHRoaXMuY3JlYXRlKCk7XG59XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5lbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgaWYgKHRoaXMuZGF0YSkge1xuICAgIHRoaXMucHJvY2Vzc0RhdGEodGhpcy5kYXRhKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmV4dHJhY3REYXRhKCk7XG4gIH1cblxuICB0aGlzLnJlbmRlckRyb3Bkb3duKCk7XG4gIHRoaXMuYmluZEV2ZW50KCk7XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5wcm9jZXNzRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIHZhciBvcHRpb25zID0gW107XG4gIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG9wdGlvbnMucHVzaCh7XG4gICAgICBkYXRhOiBpdGVtLFxuICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuZXh0cmFjdERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBvcHRpb25zID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKFwib3B0aW9uXCIpO1xuICB2YXIgZGF0YSA9IFtdO1xuICB2YXIgYWxsT3B0aW9ucyA9IFtdO1xuICB2YXIgc2VsZWN0ZWRPcHRpb25zID0gW107XG5cbiAgb3B0aW9ucy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgdmFyIGl0ZW1EYXRhID0ge1xuICAgICAgdGV4dDogaXRlbS5pbm5lclRleHQsXG4gICAgICB2YWx1ZTogaXRlbS52YWx1ZSxcbiAgICB9O1xuXG4gICAgdmFyIGF0dHJpYnV0ZXMgPSB7XG4gICAgICBzZWxlY3RlZDpcbiAgICAgICAgaXRlbS5nZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiKSAhPSBudWxsIHx8IGl0ZW0udmFsdWUgPT0gdGhpcy5lbC52YWx1ZSxcbiAgICAgIGRpc2FibGVkOiBpdGVtLmdldEF0dHJpYnV0ZShcImRpc2FibGVkXCIpICE9IG51bGwsXG4gICAgICBkaXNwbGF5OiB0cnVlLFxuICAgIH07XG5cbiAgICBkYXRhLnB1c2goaXRlbURhdGEpO1xuICAgIGFsbE9wdGlvbnMucHVzaCh7IGRhdGE6IGl0ZW1EYXRhLCBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzIH0pO1xuICB9KTtcblxuICB0aGlzLmRhdGEgPSBkYXRhO1xuICB0aGlzLm9wdGlvbnMgPSBhbGxPcHRpb25zO1xuICB0aGlzLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmIChpdGVtLmF0dHJpYnV0ZXMuc2VsZWN0ZWQpIHNlbGVjdGVkT3B0aW9ucy5wdXNoKGl0ZW0pO1xuICB9KTtcblxuICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IHNlbGVjdGVkT3B0aW9ucztcbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLnJlbmRlckRyb3Bkb3duID0gZnVuY3Rpb24gKCkge1xuICB2YXIgY2xhc3NlcyA9IFtcbiAgICBcIm5pY2Utc2VsZWN0XCIsXG4gICAgYXR0cih0aGlzLmVsLCBcImNsYXNzXCIpIHx8IFwiXCIsXG4gICAgdGhpcy5kaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCIsXG4gICAgdGhpcy5tdWx0aXBsZSA/IFwiaGFzLW11bHRpcGxlXCIgOiBcIlwiLFxuICBdO1xuXG4gIGxldCBzZWFyY2hIdG1sID0gYDxkaXYgY2xhc3M9XCJuaWNlLXNlbGVjdC1zZWFyY2gtYm94XCI+XG48aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cIm5pY2Utc2VsZWN0LXNlYXJjaFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoLi4uXCIvPlxuPC9kaXY+YDtcblxuICB2YXIgaHRtbCA9IGA8ZGl2IGNsYXNzPVwiJHtjbGFzc2VzLmpvaW4oXCIgXCIpfVwiIHRhYmluZGV4PVwiJHtcbiAgICB0aGlzLmRpc2FibGVkID8gbnVsbCA6IDBcbiAgfVwiPlxuICA8c3BhbiBjbGFzcz1cIiR7dGhpcy5tdWx0aXBsZSA/IFwibXVsdGlwbGUtb3B0aW9uc1wiIDogXCJjdXJyZW50XCJ9XCI+PC9zcGFuPlxuICA8ZGl2IGNsYXNzPVwibmljZS1zZWxlY3QtZHJvcGRvd25cIj5cbiAgJHt0aGlzLmNvbmZpZy5zZWFyY2hhYmxlID8gc2VhcmNoSHRtbCA6IFwiXCJ9XG4gIDx1bCBjbGFzcz1cImxpc3RcIj48L3VsPlxuICA8L2Rpdj48L2Rpdj5cbmA7XG5cbiAgdGhpcy5lbC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmVuZFwiLCBodG1sKTtcblxuICB0aGlzLmRyb3Bkb3duID0gdGhpcy5lbC5uZXh0RWxlbWVudFNpYmxpbmc7XG4gIHRoaXMuX3JlbmRlclNlbGVjdGVkSXRlbXMoKTtcbiAgdGhpcy5fcmVuZGVySXRlbXMoKTtcbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLl9yZW5kZXJTZWxlY3RlZEl0ZW1zID0gZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgIHZhciBzZWxlY3RlZEh0bWwgPSBcIlwiO1xuXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgc2VsZWN0ZWRIdG1sICs9IGA8c3BhbiBjbGFzcz1cImN1cnJlbnRcIj4ke2l0ZW0uZGF0YS50ZXh0fTwvc3Bhbj5gO1xuICAgIH0pO1xuICAgIHNlbGVjdGVkSHRtbCA9IHNlbGVjdGVkSHRtbCA9PSBcIlwiID8gdGhpcy5wbGFjZWhvbGRlciA6IHNlbGVjdGVkSHRtbDtcblxuICAgIHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5tdWx0aXBsZS1vcHRpb25zXCIpLmlubmVySFRNTCA9IHNlbGVjdGVkSHRtbDtcbiAgfSBlbHNlIHtcbiAgICB2YXIgaHRtbCA9XG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5sZW5ndGggPiAwXG4gICAgICAgID8gdGhpcy5zZWxlY3RlZE9wdGlvbnNbMF0uZGF0YS50ZXh0XG4gICAgICAgIDogdGhpcy5wbGFjZWhvbGRlcjtcblxuICAgIHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5jdXJyZW50XCIpLmlubmVySFRNTCA9IGh0bWw7XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLl9yZW5kZXJJdGVtcyA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHVsID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwidWxcIik7XG4gIHVsLnNjcm9sbFRvcCA9IDA7XG4gIHVsLmlubmVySFRNTCA9IFwiXCI7XG4gIHRoaXMub3B0aW9ucy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaWYgKGl0ZW0uZGlzcGxheSkge1xuICAgICAgdWwuYXBwZW5kQ2hpbGQodGhpcy5fcmVuZGVySXRlbShpdGVtKSk7XG4gICAgfVxuICB9KTtcbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLl9yZW5kZXJJdGVtID0gZnVuY3Rpb24gKG9wdGlvbikge1xuICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gIGVsLnNldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIiwgb3B0aW9uLmRhdGEudmFsdWUpO1xuXG4gIHZhciBjbGFzc0xpc3QgPSBbXG4gICAgXCJvcHRpb25cIixcbiAgICBvcHRpb24uYXR0cmlidXRlcy5zZWxlY3RlZCA/IFwic2VsZWN0ZWRcIiA6IG51bGwsXG4gICAgb3B0aW9uLmF0dHJpYnV0ZXMuZGlzYWJsZWQgPyBcImRpc2FibGVkXCIgOiBudWxsLFxuICBdO1xuXG4gIGVsLmNsYXNzTGlzdC5hZGQoLi4uY2xhc3NMaXN0KTtcbiAgZWwuaW5uZXJIVE1MID0gb3B0aW9uLmRhdGEudGV4dDtcbiAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB0aGlzLl9vbkl0ZW1TZWxlY3RlZChvcHRpb24sIGUpKTtcbiAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcInNlbGVjdFwiLCAoZSkgPT4gdGhpcy5fb25JdGVtU2VsZWN0ZWQob3B0aW9uLCBlKSk7XG4gIG9wdGlvbi5lbGVtZW50ID0gZWw7XG4gIHJldHVybiBlbDtcbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5leHRyYWN0RGF0YSgpO1xuICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgIHZhciBvcGVuID0gaGFzQ2xhc3ModGhpcy5kcm9wZG93biwgXCJvcGVuXCIpO1xuICAgIHRoaXMuZHJvcGRvd24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRyb3Bkb3duKTtcbiAgICB0aGlzLmNyZWF0ZSgpO1xuXG4gICAgaWYgKG9wZW4pIHtcbiAgICAgIHRyaWdnZXJFdmVudCh0aGlzLmRyb3Bkb3duKTtcbiAgICB9XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLmRyb3Bkb3duLmNsYXNzTGlzdC50b2dnbGUoXCJvcGVuXCIpO1xuICB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKS5zY3JvbGxUb3AgPSAwO1xuXG4gIGlmICh0aGlzLmRyb3Bkb3duLmNsYXNzTGlzdC5jb250YWlucyhcIm9wZW5cIikpIHtcbiAgICB2YXIgc2VhcmNoID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLm5pY2Utc2VsZWN0LXNlYXJjaFwiKTtcbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICBzZWFyY2gudmFsdWUgPSBcIlwiO1xuICAgICAgc2VhcmNoLmZvY3VzKCk7XG4gICAgfVxuXG4gICAgdmFyIHQgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZm9jdXNcIik7XG4gICAgcmVtb3ZlQ2xhc3ModCwgXCJmb2N1c1wiKTtcbiAgICB0ID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLnNlbGVjdGVkXCIpO1xuICAgIGFkZENsYXNzKHQsIFwiZm9jdXNcIik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9wdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMub3B0aW9uc1tpXS5kaXNwbGF5ID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVySXRlbXMoKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmRyb3Bkb3duLmZvY3VzKCk7XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGFkZENsYXNzKHRoaXMuZHJvcGRvd24sIFwiZGlzYWJsZWRcIik7XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgcmVtb3ZlQ2xhc3ModGhpcy5kcm9wZG93biwgXCJkaXNhYmxlZFwiKTtcbiAgfVxufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XG4gIHRoaXMuX3JlbmRlclNlbGVjdGVkSXRlbXMoKTtcbiAgdGhpcy51cGRhdGVTZWxlY3RWYWx1ZSgpO1xuICB0cmlnZ2VyQ2hhbmdlKHRoaXMuZWwpO1xufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuZHJvcGRvd24pIHtcbiAgICB0aGlzLmRyb3Bkb3duLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kcm9wZG93bik7XG4gICAgdGhpcy5lbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgfVxufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuYmluZEV2ZW50ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgJHRoaXMgPSB0aGlzO1xuICB0aGlzLmRyb3Bkb3duLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9vbkNsaWNrZWQuYmluZCh0aGlzKSk7XG4gIHRoaXMuZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fb25LZXlQcmVzc2VkLmJpbmQodGhpcykpO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX29uQ2xpY2tlZE91dHNpZGUuYmluZCh0aGlzKSk7XG5cbiAgaWYgKHRoaXMuY29uZmlnLnNlYXJjaGFibGUpIHtcbiAgICB0aGlzLl9iaW5kU2VhcmNoRXZlbnQoKTtcbiAgfVxufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuX2JpbmRTZWFyY2hFdmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlYXJjaEJveCA9IHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvcihcIi5uaWNlLXNlbGVjdC1zZWFyY2hcIik7XG4gIGlmIChzZWFyY2hCb3gpXG4gICAgc2VhcmNoQm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICBzZWFyY2hCb3guYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIHRoaXMuX29uU2VhcmNoQ2hhbmdlZC5iaW5kKHRoaXMpKTtcbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLl9vbkNsaWNrZWQgPSBmdW5jdGlvbiAoZSkge1xuICB0aGlzLmZvY3VzKCk7XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5fb25JdGVtU2VsZWN0ZWQgPSBmdW5jdGlvbiAob3B0aW9uLCBlKSB7XG4gIGUgPSBlLmRldGFpbCB8fCBlO1xuICB2YXIgb3B0aW9uRWwgPSBlLnRhcmdldDtcblxuICBpZiAoIWhhc0NsYXNzKG9wdGlvbkVsLCBcImRpc2FibGVkXCIpKSB7XG4gICAgdGhpcy5kcm9wZG93bi5jbGFzc0xpc3QucmVtb3ZlKFwib3BlblwiKTtcbiAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgaWYgKCFoYXNDbGFzcyhvcHRpb25FbCwgXCJzZWxlY3RlZFwiKSkge1xuICAgICAgICBhZGRDbGFzcyhvcHRpb25FbCwgXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMucHVzaChvcHRpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJlbW92ZUNsYXNzKGl0ZW0uZWxlbWVudCwgXCJzZWxlY3RlZFwiKTtcbiAgICAgIH0pO1xuXG4gICAgICBhZGRDbGFzcyhvcHRpb25FbCwgXCJzZWxlY3RlZFwiKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW29wdGlvbl07XG4gICAgfVxuXG4gICAgdGhpcy5kaXNwYXRjaE9uQ2hhbmdlZChlKTtcblxuICAgIHRoaXMuX3JlbmRlclNlbGVjdGVkSXRlbXMoKTtcbiAgICB0aGlzLnVwZGF0ZVNlbGVjdFZhbHVlKCk7XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLmRpc3BhdGNoT25DaGFuZ2VkID0gZnVuY3Rpb24gKGUpIHtcbiAgaWYgKHRoaXMuY29uZmlnLm9uQ2hhbmdlZCkge1xuICAgIGxldCB2YWx1ZXMgPSB0aGlzLnNlbGVjdGVkT3B0aW9ucy5tYXAoKGUpID0+IGUuZGF0YS52YWx1ZSk7XG4gICAgdGhpcy5jb25maWcub25DaGFuZ2VkKHZhbHVlcywgZSk7XG4gIH1cbn07XG5cbk5pY2VTZWxlY3QucHJvdG90eXBlLnVwZGF0ZVNlbGVjdFZhbHVlID0gZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLmVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHZhciBlbCA9IHRoaXMuZWwucXVlcnlTZWxlY3Rvcignb3B0aW9uW3ZhbHVlPVwiJyArIGl0ZW0uZGF0YS52YWx1ZSArICdcIl0nKTtcbiAgICAgIGlmIChlbCkgZWwuc2V0QXR0cmlidXRlKFwic2VsZWN0ZWRcIiwgdHJ1ZSk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoID4gMCkge1xuICAgIHRoaXMuZWwudmFsdWUgPSB0aGlzLnNlbGVjdGVkT3B0aW9uc1swXS5kYXRhLnZhbHVlO1xuICB9XG4gIHRyaWdnZXJDaGFuZ2UodGhpcy5lbCk7XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5fb25DbGlja2VkT3V0c2lkZSA9IGZ1bmN0aW9uIChlKSB7XG4gIGlmICghdGhpcy5kcm9wZG93bi5jb250YWlucyhlLnRhcmdldCkpIHtcbiAgICB0aGlzLmRyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoXCJvcGVuXCIpO1xuICB9XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5fb25LZXlQcmVzc2VkID0gZnVuY3Rpb24gKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAvLyBLZXlib2FyZCBldmVudHNcbiAgdmFyIGZvY3VzZWRPcHRpb24gPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZm9jdXNcIik7XG5cbiAgdmFyIG9wZW4gPSB0aGlzLmRyb3Bkb3duLmNsYXNzTGlzdC5jb250YWlucyhcIm9wZW5cIik7XG5cbiAgLy8gU3BhY2Ugb3IgRW50ZXJcbiAgaWYgKGUua2V5Q29kZSA9PSAxMykge1xuICAgIGlmIChvcGVuKSB7XG4gICAgICBsZXQgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoXCJzZWxlY3RcIiwge1xuICAgICAgICBkZXRhaWw6IGUsXG4gICAgICB9KTtcbiAgICAgIHRyaWdnZXJFdmVudChmb2N1c2VkT3B0aW9uLCBldmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRyaWdnZXJFdmVudCh0aGlzLmRyb3Bkb3duKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDQwKSB7XG4gICAgLy8gRG93blxuICAgIGlmICghb3Blbikge1xuICAgICAgdHJpZ2dlckV2ZW50KHRoaXMuZHJvcGRvd24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbmV4dCA9IHRoaXMuX2ZpbmROZXh0KGZvY3VzZWRPcHRpb24pO1xuICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZm9jdXNcIik7XG4gICAgICAgIHJlbW92ZUNsYXNzKHQsIFwiZm9jdXNcIik7XG4gICAgICAgIGFkZENsYXNzKG5leHQsIFwiZm9jdXNcIik7XG4gICAgICAgIGlmICghaXNTY3JvbGxlZEludG9WaWV3KG5leHQsIG5leHQucGFyZW50RWxlbWVudCkpIHtcbiAgICAgICAgICBuZXh0LnBhcmVudEVsZW1lbnQuc2Nyb2xsVG9wICs9IG5leHQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMzgpIHtcbiAgICAvLyBVcFxuICAgIGlmICghb3Blbikge1xuICAgICAgdHJpZ2dlckV2ZW50KHRoaXMuZHJvcGRvd24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcHJldiA9IHRoaXMuX2ZpbmRQcmV2KGZvY3VzZWRPcHRpb24pO1xuICAgICAgaWYgKHByZXYpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIuZm9jdXNcIik7XG4gICAgICAgIHJlbW92ZUNsYXNzKHQsIFwiZm9jdXNcIik7XG4gICAgICAgIGFkZENsYXNzKHByZXYsIFwiZm9jdXNcIik7XG4gICAgICAgIGlmICghaXNTY3JvbGxlZEludG9WaWV3KHByZXYsIHByZXYucGFyZW50RWxlbWVudCkpIHtcbiAgICAgICAgICBwcmV2LnBhcmVudEVsZW1lbnQuc2Nyb2xsVG9wIC09IHByZXYub2Zmc2V0SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMjcgJiYgb3Blbikge1xuICAgIC8vIEVzY1xuICAgIHRyaWdnZXJFdmVudCh0aGlzLmRyb3Bkb3duKTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5fZmluZE5leHQgPSBmdW5jdGlvbiAoZWwpIHtcbiAgaWYgKGVsKSB7XG4gICAgZWwgPSBlbC5uZXh0RWxlbWVudFNpYmxpbmc7XG4gIH0gZWxzZSB7XG4gICAgZWwgPSB0aGlzLmRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoXCIubGlzdCAub3B0aW9uXCIpO1xuICB9XG5cbiAgd2hpbGUgKGVsKSB7XG4gICAgaWYgKCFoYXNDbGFzcyhlbCwgXCJkaXNhYmxlZFwiKSAmJiBlbC5zdHlsZS5kaXNwbGF5ICE9IFwibm9uZVwiKSB7XG4gICAgICByZXR1cm4gZWw7XG4gICAgfVxuICAgIGVsID0gZWwubmV4dEVsZW1lbnRTaWJsaW5nO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5OaWNlU2VsZWN0LnByb3RvdHlwZS5fZmluZFByZXYgPSBmdW5jdGlvbiAoZWwpIHtcbiAgaWYgKGVsKSB7XG4gICAgZWwgPSBlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICB9IGVsc2Uge1xuICAgIGVsID0gdGhpcy5kcm9wZG93bi5xdWVyeVNlbGVjdG9yKFwiLmxpc3QgLm9wdGlvbjpsYXN0LWNoaWxkXCIpO1xuICB9XG5cbiAgd2hpbGUgKGVsKSB7XG4gICAgaWYgKCFoYXNDbGFzcyhlbCwgXCJkaXNhYmxlZFwiKSAmJiBlbC5zdHlsZS5kaXNwbGF5ICE9IFwibm9uZVwiKSB7XG4gICAgICByZXR1cm4gZWw7XG4gICAgfVxuICAgIGVsID0gZWwucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxuTmljZVNlbGVjdC5wcm90b3R5cGUuX29uU2VhcmNoQ2hhbmdlZCA9IGZ1bmN0aW9uIChlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIG9wZW4gPSB0aGlzLmRyb3Bkb3duLmNsYXNzTGlzdC5jb250YWlucyhcIm9wZW5cIik7XG4gIHZhciB0ZXh0ID0gZS50YXJnZXQudmFsdWU7XG4gIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG5cbiAgaWYgKHRleHQgPT0gXCJcIikge1xuICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpdGVtLmRpc3BsYXkgPSB0cnVlO1xuICAgIH0pO1xuICAgIHRoaXMuX3JlbmRlckl0ZW1zKCk7XG4gIH0gZWxzZSBpZiAob3Blbikge1xuICAgIHZhciBtYXRjaFJlZyA9IG5ldyBSZWdFeHAodGV4dCk7XG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHZhciBvcHRpb25UZXh0ID0gaXRlbS5kYXRhLnRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciBtYXRjaGVkID0gbWF0Y2hSZWcudGVzdChvcHRpb25UZXh0KTtcbiAgICAgIGl0ZW0uZGlzcGxheSA9IG1hdGNoZWQ7XG4gICAgfSk7XG4gICAgdGhpcy5fcmVuZGVySXRlbXMoKTtcbiAgfVxuXG4gIHRoaXMuZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbChcIi5mb2N1c1wiKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgcmVtb3ZlQ2xhc3MoaXRlbSwgXCJmb2N1c1wiKTtcbiAgfSk7XG5cbiAgdmFyIGZpcnN0RWwgPSB0aGlzLl9maW5kTmV4dChudWxsKTtcbiAgYWRkQ2xhc3MoZmlyc3RFbCwgXCJmb2N1c1wiKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBiaW5kKGVsLCBvcHRpb25zKSB7XG4gIHJldHVybiBuZXcgTmljZVNlbGVjdChlbCwgb3B0aW9ucyk7XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzFfXzsiXSwic291cmNlUm9vdCI6IiJ9